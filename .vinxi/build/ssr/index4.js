import{ssr as n,ssrHydrationKey as i,escape as o,createComponent as t}from"solid-js/web";import{onMount as p,onCleanup as d,createSignal as g}from"solid-js";import{B as f}from"./assets/ButtonSparkle-DNpTyev3.js";import{S,a as w,g as u,I as m,b as E}from"./assets/Inputs-BxVpbjg0.js";import{s as c}from"./assets/Menu-CNxWw250.js";import{c as _,d as C}from"./assets/db.server-Cxzv6220.js";import{u as v}from"./assets/fetchEvent-Ce2Ui3zq.js";import*as h from"bcryptjs";import{b as I,u as y}from"./assets/action-DzH6FtPs.js";import{u as U}from"./assets/routing-DxIlI4R1.js";import"solid-js/store";import"gsap";import"./assets/components-eKl611cl.js";import"solid-js/web/storage";import"pg";import"h3";import"node:async_hooks";const R=_(async r=>{const{password:a,username:l}=r;try{const e=await C.query("SELECT id, username, password FROM users WHERE username = $1",[l]);if(e.rows.length===0)return{success:!1,message:"Credenziali non valide"};const s=e.rows[0];return await h.compare(a,s.password)?(await(await v({password:process.env.SESSION_SECRET,name:"auth_session"})).update({userId:s.id,username:s.username}),console.log(`Sessione (cookie criptato) aggiornata per utente ${s.username}`),{success:!0}):{success:!1,message:"Credenziali non valide"}}catch(e){return console.error("Errore durante il login:",e),process.env.SESSION_SECRET?{success:!1,message:"Errore durante il processo di login"}:(console.error("SESSION_SECRET non Ã¨ impostata!"),{success:!1,message:"Errore di configurazione server."})}},"src_routes_API_Auth_login_loginUser_ts--loginUser_action","C:/Users/Matteo/Desktop/Pulsix/src/routes/API/Auth/login/loginUser.ts?tsr-directive-use-server="),$=I(R,"loginUser");var P=["<form",' class="CM" method="post"><!--$-->',"<!--/--><!--$-->","<!--/--><!--$-->","<!--/--></form>"],b=["<p",' class="text-red-500">Wrong credentials</p>'];function G(){p(()=>{c(!1),S({}),w({}),console.log(u("username")),console.log(u("password"))}),d(()=>{c(!0)});const[r,a]=g("");return y($),U(),[r()&&n(b,i())," ",n(P,i(),o(t(m,{type:"usernameLogin",name:"username",placeholder:"Username",required:!0})),o(t(m,{type:"password",name:"password",placeholder:"Password",required:!0})),o(t(f,{text:"Login",class:"ml-[auto] mr-[auto]",get disabled(){return!E()}})))]}export{G as default};
