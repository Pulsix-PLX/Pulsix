import{createComponent as t,ssr as i,ssrHydrationKey as c,escape as l,ssrAttribute as T}from"solid-js/web";import{createSignal as u,createResource as E,Show as m,onMount as B,onCleanup as W,createEffect as M,Suspense as H,Switch as N,Match as v,lazy as K,createMemo as A,For as F}from"solid-js";import{E as L}from"./assets/Title-C8lsFfVd.js";import{a as O,b as V}from"./assets/getWallets.server-C5R6kBVO.js";import{g as P}from"./assets/auth.server-ChqlnWrh.js";import"./assets/prova-B1NEQR2_.js";import{e as I,C as Z}from"./assets/index-D0aODT57.js";import{c as G}from"./assets/exchangeRates-BGrzYQig.js";import{W as Y,S as J}from"./assets/index-0U8vmGbf.js";import{g as q,T as X}from"./assets/index-BQH3GIDW.js";import{g as Q}from"./assets/deleteWallet-Cgff9KFR.js";import"@splinetool/runtime";import{u as ee,j as te,i as re}from"./assets/routing-BRXp7sqN.js";import{I as x,a as ne}from"./assets/Inputs-D1T1pLkj.js";import{B as j}from"./assets/ButtonSparkle-BxHzGCPC.js";/* empty css                     */import"./assets/auth-BeHg-fWi.js";import"./assets/server-fns-runtime-C3tiYEg6.js";import"solid-js/web/storage";import"./assets/fetchEvent-9EzSf9d7.js";import"h3";import"vite-plugin-node-polyfills/shims/global";import"node:async_hooks";import"./assets/db.server-CDeyn5Z_.js";import"vite-plugin-node-polyfills/shims/process";import"pg";import"./assets/components-DHKGOKg1.js";import"./assets/Card.module-nMwE8ysR.js";/* empty css                     */import"./assets/action-BR9kmesq.js";import"solid-js/store";import"gsap";import"axios";const[ct,k]=u(null),[st,ut]=u(null);var ae=["<div",' class="CM mt-[15vw]">',"</div>"];function oe(o){console.log("props",o);const[p,{refetch:h}]=E(()=>o.id,q);return t(m,{get when(){return p()},get children(){return i(ae,c(),l(t(X,{get transactions(){return p()},refetch:h})))}})}var le=["<div",' style="','">Loading...</div>'],ie=["<div",' style="','"><strong>Errore Caricamento Spline</strong><pre style="','">',"</pre></div>"],ce=["<canvas",' style="','"></canvas>'],se=["<img",' class="absolute ml-[20.7vw] -mt-[6vw] w-23" src="/icons/edit.png">'],ue=["<div",' class="landing-container"><div class="spline-wrapper" style="','"><!--$-->',"<!--/--><!--$-->","<!--/--><!--$-->","<!--/--><!--$-->","<!--/--></div></div>"];function de(o){const[p,h]=u(!1),y=()=>{switch(console.log(`[Card3D ${o.id}] Calcolo URL per colore: ${o.color}`),o.color){case"purple":return"https://prod.spline.design/j0mVtZ9nPBu6RBRy/scene.splinecode";default:return"https://prod.spline.design/mzKeaOgjz2ILR0uC/scene.splinecode"}};B(()=>{console.error(`[Card3D ${o.id}] Errore: Canvas ref non trovato in onMount!`),W(()=>{console.log(`[Card3D ${o.id}] Cleanup: reset isCanvasReady.`),h(!1)})});const[r]=E(()=>p()?y():null,async a=>{throw console.error(`[Card3D ${o.id}] Fetcher: CanvasRef è nullo! Impossibile caricare.`),new Error("Canvas element reference is missing.")});M(a=>{const s=r();return a&&a!==s&&(console.log(`[Card3D ${o.id}] createEffect[cleanup]: Dispose istanza Spline precedente.`),a.dispose()),s},void 0),W(()=>{const a=r.latest;a?(console.log(`[Card3D ${o.id}] onCleanup: Dispose istanza Spline finale.`),a.dispose()):console.log(`[Card3D ${o.id}] onCleanup: Nessuna istanza Spline da pulire.`)}),M(()=>{const a=r();if(!a||r.loading||r.error)return;console.log(`[Card3D ${o.id}] Effetto Variabili: Esecuzione...`);const s="Group 2",n={x:1.2,y:1.2,z:1.2},d="wallet_name",f=o.name,D="balance",z=g=>{switch(g){case"EUR":return"€";case"USD":return"$";case"GBP":return"£";case"CHF":return"CHF";case"CAD":return"C$";case"AUD":return"A$";case"JPY":return"¥";case"CNY":return"¥";case"INR":return"₹";case"BRL":return"R$";case"MXN":return"$";case"NZD":return"$";case"SGD":return"$";case"HKD":return"$";case"SEK":return"kr";case"NOK":return"kr";case"DKK":return"kr";case"PLN":return"zł";case"CZK":return"Kč";case"HUF":return"Ft";case"RUB":return"₽";case"TRY":return"₺";case"ZAR":return"R";case"AED":return"د. إ";default:return g}},C=`${o.balance} ${z(o.currency)}`;console.log(`[Card3D ${o.id}] -> Aggiorno: ${d}=${f}, ${D}=${C}`);try{a.setVariable(d,f),a.setVariable(D,C);const g=a.findObjectByName(s);g?typeof g?.scale?.x=="number"?Object.assign(g.scale,n):console.warn(`[Card3D ${o.id}] -> ATTENZIONE: 'scale' non trovato su '${s}'.`):console.warn(`[Card3D ${o.id}] -> ATTENZIONE: Oggetto '${s}' non trovato.`)}catch(g){console.error(`[Card3D ${o.id}] -> ERRORE durante interazione Spline:`,g)}}),ee();const[S,w]=u(!0),[$,U]=u(!1),[b,R]=u(0),[_,e]=u(!1);return i(ue,c(),"width:80%;height:500px;position:relative",l(t(m,{get when(){return r.loading},get children(){return i(le,c(),"width:90%;height:45%;inset:0;margin-top:130px;background:rgba(0, 0, 0, 0.6);display:flex;justify-content:center;align-items:center;border-radius:8px;z-index:10;color:white;font-size:1.1em")}})),l(t(m,{get when(){return r.error&&!r.loading},get children(){return i(ie,c(),"position:absolute;inset:0;background:rgba(255, 200, 200, 0.9);color:darkred;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:15px;border-radius:8px;z-index:10;text-align:center;font-size:0.9em","margin-top:8px;white-space:pre-wrap;max-height:100px;overflow:auto",l(r.error?.message)||l(JSON.stringify(r.error)))}})),l(t(H,{get fallback(){return[]},get children(){return i(ce,c(),"width:100%;height:100%;display:block;outline:none"+(";opacity:"+(r.loading||r.error?.3:1))+";background-color:transparent;transition:opacity 0.4s ease-in-out")}})),l(t(m,{get when(){return _()},get children(){return i(se,c())}})))}var ge=["<img",' src="/icons/Delete.png" class=" CM w-16 h-16 mt-[27vh] ml-[11vw] z-50">'],me=["<form",' class="CM w-[25vw] mt-[25vh] pl-[5vw] pr-[5vw] pb-[2vw] pt-[2vw] min-w-[280px] min-h-[200px]" style="','"><div class="flex flex-row gap-100"><button>Container</button><button>Wallet</button></div></form>'],pe=["<div",' class="color-picker-container" style="','">',"</div>"],he=["<div",' style="','"><select name="color" value="black"><option value="black">Black</option><option value="purple">Purple</option></select></div>'],we=["<form",' class="CM w-[25vw] mt-[22vh] pl-[5vw] pr-[5vw] pb-[2vw] pt-[2vw]" style="','"><!--$-->','<!--/--><select name="currency"><option value="USD">USD</option><option value="EUR" selected>EUR</option><option value="CHF">CHF</option></select><!--$-->',"<!--/--><!--$-->",'<!--/--><select name="type_ui" class="mb-[2vw]"><option value="card">Card</option><option value="3D">3D</option></select><!--$-->',"<!--/--><!--$-->","<!--/--></form>"],fe=["<form",' class="CM w-[25vw] mt-[22vh] pl-[5vw] pr-[5vw] pb-[2vw] pt-[2vw]" style="','"><input type="hidden" name="type"','><input type="hidden" name="user_id"','><input type="hidden" name="container_id"',"><!--$-->","<!--/--><!--$-->","<!--/--><!--$-->","<!--/--></form>"],ve=["<div",">Loading Color Picker...</div>"];const ye=K(()=>import("./assets/index-WwoiZKEg.js").then(o=>({default:o.DefaultColorPicker})));function $e({container_id:o,user_id:p}){const[h,y]=u(null),[r,S]=u("card"),[w,$]=u("grey"),[U,b]=u(!1),[R,_]=u(null);return t(m,{get when(){return I()==-1},get children(){return[i(ge,c()),t(N,{get children(){return[t(v,{get when(){return!h()},get children(){return i(me,c(),"border:3px solid rgba(255, 255, 255, 0.3);border-radius:40px")}}),t(v,{get when(){return h()=="wallet"},get children(){return i(we,c(),`border:3px solid ${l(w(),!0)};border-radius:40px`,l(t(x,{type:"text",name:"walletName",placeholder:"Wallet Name",defaultError:"Provide",required:!0})),l(t(x,{type:"text",name:"category_id",placeholder:"Category"})),l(t(x,{type:"text",name:"nation",placeholder:"nation"})),l(t(N,{get children(){return[t(v,{get when(){return r()=="card"},get children(){return i(pe,c(),"margin-bottom:2rem",l(t(H,{get fallback(){return i(ve,c())},get children(){return t(ye,{get value(){return w()},onChange:e=>$(e),format:"hex"})}})))}}),t(v,{get when(){return r()=="3D"},get children(){return i(he,c(),"margin-bottom:2rem")}})]}})),l(t(j,{text:"Add Wallet",class:"ml-[auto] mr-[auto]",size:"large",get shadowColor(){return`${w()}`},shadow:10,get disabled(){return!ne()}})))}}),t(v,{get when(){return h()=="container"},get children(){return i(fe,c(),`border:3px solid ${l(w(),!0)};border-radius:40px`,T("value",l(h(),!0)||"null",!1),T("value",l(p,!0)||"null",!1),T("value",l(o,!0)||"null",!1),l(t(x,{type:"text",name:"walletName",placeholder:"Wallet Name"})),l(t(x,{type:"text",name:"category_id",placeholder:"Category"})),l(t(j,{text:"Add Container",class:"ml-[auto] mr-[auto]",size:"large",get shadowColor(){return`${w()}`},shadow:10})))}})]}})]}})}var Ce=["<div",' class="text-red-500 ml-[13vw] mt-2">Error loading data: <!--$-->',"<!--/--></div>"],be=["<div",' class="ml-[13vw] mt-5">Loading...</div>'],_e=["<div",' class="','"><button type="button">Add Wallet</button></div>'],De=["<p",' class="CM mt-100">',"</p>"],xe=["<div",' class="','"><!--$-->',"<!--/--><!--$-->","<!--/--></div>"],Ie=["<div",' class="CM mt-400 text-gray-500">Nothing in this container</div>'],Re=["<div",' class="mb-50 mt-50 z-50 px-2">',"</div>"],Ee=["<div",' class="mb-50 z-50 px-2 -mt-180">',"</div>"];function dt(){const[o,p]=u(null);B(async()=>{try{const e=await P();e==null?(console.warn("[onMount] getUserId ha restituito null/undefined."),p(null)):p(e)}catch(e){console.error("[onMount] Errore durante recupero userId:",e),p(null)}});const h=te(),y=A(()=>{const s=(h.slug??"").split("/").filter(f=>f!=="").pop(),n=parseInt(s||"",10);return isNaN(n)?null:n},null),[r]=E(()=>{const e=o(),a=y();return I(),e!=null?{userId:e,containerId:a}:null},async e=>{const{userId:a,containerId:s}=e;try{let n=null,d=null,f=null,D=null;if(s===null)n="My Wallets",d="container",console.log("[Fetcher Updated] Caso ROOT, recupero contenuto..."),f=await O(a,null)??[];else{const C=await V(s);if(C&&C.length>0){const g=C[0];n=g.wallet_name,d=g.type,d==="container"?(f=await O(a,s)??[],f==-1&&(window.location.href="/LoginRegistration")):console.log(`[Fetcher Updated] È ${d}, non recupero contenuto.`),d==="wallet"?D=await Q(s)??[]:console.log(`[Fetcher Updated] È ${d}, non recupero contenuto.`)}else console.warn(`[Fetcher Updated] Item non trovato per ID: ${s}`),n="Elemento Non Trovato"}return{name:n,type:d,content:f,wallet:D}}catch(n){throw window.location.href="/LoginRegistration",console.error("[Fetcher Updated] Errore:",n),n}});function S(e){const a=r()?.content;return a?a.filter(n=>n.container_id===e&&n.type==="wallet").map(n=>({color:n.color,wallet:n.wallet_name,balance:n.balance,currency:n.currency,id:n.id})):[]}const w=A(()=>{const e=r()?.content,a=y();return e?e.filter(n=>n.container_id===a):[]}),$=(e,a)=>`${e.endsWith("/")?e.slice(0,-1):e}/${a}`,b=re().pathname,R="EUR",[_]=E(()=>({containerId:y(),targetCurrency:R,edit:I()}),async e=>{const{containerId:a,targetCurrency:s}=e;try{const n=await P();if(n===null)throw new Error("Utente non autenticato per calcolo totale.");return await G(a,s,n)}catch(n){throw console.error(`[ConvertedTotalResource] Error fetching/calculating total for container ${a}:`,n),n}});return[t(m,{get when(){return r.state==="ready"},get fallback(){return t(L,{title:"Loading title..."})},get children(){return t(L,{get title(){return r()?.name??"Wallet"}})}}),t(m,{get when(){return r.error},get children(){return i(Ce,c(),l(r.error.message))}}),t(m,{get when(){return r.loading||r.state==="unresolved"},get children(){return i(be,c())}}),t(m,{get when(){return r()?.type==="container"},get children(){return[i(_e,c(),"CM ml-[10vw]"),t($e,{get container_id(){return y()},get user_id(){return o()}}),i(De,c(),l((_()?.total_balance??0).toLocaleString("it-IT",{style:"currency",currency:_()?.currency_code??R,minimumFractionDigits:2,maximumFractionDigits:2}))),t(N,{get children(){return[t(v,{get when(){return r.state==="ready"&&r()&&I()==null},get children(){return[i(xe,c(),"ml-[13vw] mt-[20vw] grid grid-cols-3 gap-x-0 gap-y-300",l(t(F,{get each(){return w().filter(e=>e.type==="container")},children:e=>t(Z,{get data(){return S(e.id)},get id(){return e.id},get name(){return e.wallet_name},get currency(){return e.currency},get href(){return $(b,e.id)},onclick:()=>{k(e.id)}})})),l(t(F,{get each(){return w().filter(e=>e.type==="wallet")},children:e=>t(N,{get children(){return[t(v,{get when(){return e.type_ui==="card"},get children(){return i(Re,c(),l(t(Y,{get name(){return e.wallet_name},get balance(){return e.balance},get currency(){return e.currency},get nation(){return e.nation},get category(){return e.category_id},get color(){return e.color},get href(){return $(b,e.id)},onClick:()=>k(e.id),get id(){return e.id}})))}}),t(v,{get when(){return e.type_ui==="3D"},get children(){return i(Ee,c(),l(t(de,{get name(){return e.wallet_name},get balance(){return e.balance},get currency(){return e.currency},get color(){return e.color},get href(){return $(b,e.id)},onClick:()=>k(e.id),get id(){return e.id}})))}})]}})}))),t(m,{get when(){return w().length===0&&r.state==="ready"},get children(){return i(Ie,c())}})]}}),t(v,{get when(){return I()},get children(){return t(J,{})}})]}})]}}),t(m,{get when(){return r()?.type==="wallet"},get children(){return t(oe,{get id(){return r()?.wallet?.id},get wallet_name(){return r()?.wallet?.wallet_name??"null"},get currency(){return r()?.wallet?.currency??"null"},get category_id(){return r()?.wallet?.category_id??0},get nation(){return r()?.wallet?.nation??"null"},get balance(){return r()?.wallet?.balance??0},get type(){return r()?.wallet?.type??"wallet"},get description(){return r()?.wallet?.description??""},get user_id(){return r()?.wallet?.user_id??0},date_of_add:new Date,get container_id(){return r()?.wallet?.container_id??0},get color(){return r()?.wallet?.color??"null"},get type_ui(){return r()?.wallet?.type_ui??"null"}})}})]}export{dt as default};
