import{ssr as n,ssrHydrationKey as i,escape as o,createComponent as t}from"solid-js/web";import{onMount as p,onCleanup as d,createSignal as g}from"solid-js";import{B as f}from"./assets/ButtonSparkle-DNpTyev3.js";import{S,a as w,g as u,I as m,b as E}from"./assets/Inputs-CEYxPBfP.js";import{s as c}from"./assets/Menu-OQmUNT5t.js";import{c as _}from"./assets/server-fns-runtime-4T1EILgx.js";import{u as C}from"./assets/fetchEvent-1KlzQMFw.js";import{d as v}from"./assets/db.server-BYnrqg0d.js";import*as h from"bcryptjs";import{a as I,u as y}from"./assets/action-BVKOmiKt.js";import{u as U}from"./assets/routing-BSDkuvr3.js";import"solid-js/store";import"gsap";import"./assets/components-CJF4pMQg.js";import"solid-js/web/storage";import"h3";import"node:async_hooks";import"pg";const R=_(async s=>{const{password:a,username:l}=s;try{const e=await v.query("SELECT id, username, password FROM users WHERE username = $1",[l]);if(e.rows.length===0)return{success:!1,message:"Credenziali non valide"};const r=e.rows[0];return await h.compare(a,r.password)?(await(await C({password:process.env.SESSION_SECRET,name:"auth_session"})).update({userId:r.id,username:r.username}),console.log(`Sessione (cookie criptato) aggiornata per utente ${r.username}`),{success:!0}):{success:!1,message:"Credenziali non valide"}}catch(e){return console.error("Errore durante il login:",e),process.env.SESSION_SECRET?{success:!1,message:"Errore durante il processo di login"}:(console.error("SESSION_SECRET non Ã¨ impostata!"),{success:!1,message:"Errore di configurazione server."})}},"src_routes_API_Auth_login_loginUser_ts--loginUser_action","C:/Users/Matteo/Desktop/Pulsix/src/routes/API/Auth/login/loginUser.ts?tsr-directive-use-server="),$=I(R,"loginUser");var P=["<form",' class="CM" method="post"><!--$-->',"<!--/--><!--$-->","<!--/--><!--$-->","<!--/--></form>"],A=["<p",' class="text-red-500">Wrong credentials</p>'];function J(){p(()=>{c(!1),S({}),w({}),console.log(u("username")),console.log(u("password"))}),d(()=>{c(!0)});const[s,a]=g("");return y($),U(),[s()&&n(A,i())," ",n(P,i(),o(t(m,{type:"usernameLogin",name:"username",placeholder:"Username",required:!0})),o(t(m,{type:"password",name:"password",placeholder:"Password",required:!0})),o(t(f,{text:"Login",class:"ml-[auto] mr-[auto]",get disabled(){return!E()}})))]}export{J as default};
