import{d as Le,g as a,t as o,b as c,i as l,c as we,u as Ne,e as Y,r as K,a as Xe,j as re}from"./web-DpIebe6J.js";import{k as ie,f as V,p as xt,n as _t,o as yt,a as i,F as de,S as P,d as L}from"./solid-DuWri35y.js";import{r as Ye,c as f,s as Ae,u as St,a as me,i as Ct,b as wt,d as Et,e as Dt}from"./context-DGrJV8BX.js";import{B as Pe}from"./ButtonSparkle-B8MvXRxa.js";import{a as Ve}from"./auth-MpTwZCDD.js";import{s as Mt}from"./Menu-CJHi8x7g.js";import{P as It}from"./pathWallets-V9UfGynM.js";import"./store-EkIb7068.js";import"./index-Ckjqp3wL.js";import"./index-BbP3371Q.js";import"./index-BAMY2Nnw.js";import"./index-CgqXENQe.js";import"./components-BSHtZ-Zq.js";import"./routing-CrKy3yVb.js";import"./Inputs-DcqJwVVk.js";import"./server-runtime-G1njbCYf.js";import"./action-Dtdjs7R9.js";import"./getWallets.server-rCnpGkki.js";import"./auth.server-BY2lFEoQ.js";var Tt=o('<div class="p-6 border rounded-lg shadow-lg mb-6 bg-white"><h2 class="text-2xl font-bold mb-3">Anteprima Dati (Contestualizzata)</h2><p class="text-sm text-gray-600 mb-4">Dataset con <!$><!/> righe totali - <span class="font-medium text-blue-600">Clicca su una cella per modificare</span>(Salvataggio automatico uscendo dalla cella)</p><div class="overflow-auto border border-gray-200 rounded-lg relative"><div><table class="w-full bg-white border-separate border-spacing-0"><thead class="sticky top-0 z-10 bg-gray-100"><tr></tr></thead><tbody></tbody></table></div></div><div class="mt-4 text-sm text-gray-500"><p>Scorri per visualizzare più righe. Clicca una cella per modificarla (Invio salva ed esce, Esc annulla, click su altra cella/fuori salva).'),Pt=o(`<div class="mt-6 flex justify-end items-center"> <div class="flex space-x-2"><button class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300"title="Annulla l'intero processo di importazione">Annulla Processo</button><!$><!/>`),kt=o("<th>"),zt=o('<tr class="hover:bg-gray-50 border-b border-gray-200">'),Nt=o('<input type=text class="w-full h-full px-4 py-3 ...">'),At=o("<td>"),Lt=o('<div class="w-full h-full flex items-center cursor-pointer">'),Vt=o('<button class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Procedi');const Rt=g=>{const N=g.rowHeight||48,ae=g.tableHeight||800,m=g.tableWidth||"100%",A=g.cellPadding||"py-3 px-4",[h,_]=ie([]),[E,u]=ie(null),[D,ue]=ie(0);let k;const $=V(()=>typeof window<"u"?Math.min(ae,window.innerHeight*.8):ae),$e=V(()=>Math.ceil($()/N)+5),z=V(()=>Math.max(0,Math.floor(D()/N))),pe=V(()=>{const r=h();if(!r)return[];const e=z(),t=$e(),n=Math.min(e+t,r.length);return r.slice(e,n)}),be=V(()=>h()?.length*N||0);xt(()=>{const e=g.rows?.map(t=>({...t}))||[];_(e)});const ee=r=>{ue(r.target.scrollTop)},te=(r,e,t)=>{const n=z()+r,x=h();if(!x||n<0||n>=x.length){console.error("saveDataToContext: Indice riga non valido o dati non pronti:",n);return}const p=x[n]?.[e];if(String(p??"")===String(t??""))return;const M=[...x],y={...M[n]};y[e]=t,M[n]=y,console.log(`✅ Dati pronti per CONTEXT => Riga Assoluta: ${n}, Header: "${e}", Nuovo Valore: "${t}"`),St(M)},O=()=>{E()!==null&&u(null)},Ee=(r,e)=>{const t=E();t?.visibleRowIndex===r&&t?.header===e||u({visibleRowIndex:r,header:e})},he=r=>{const e=E();e&&te(e.visibleRowIndex,e.header,r.target.value)},d=r=>{const e=E();e&&(r.key==="Enter"?(r.preventDefault(),te(e.visibleRowIndex,e.header,r.target.value),O()):r.key==="Escape"&&O())},H=r=>{E()&&k&&!k.contains(r.target)&&O()};_t(()=>{k&&k.addEventListener("scroll",ee),document.addEventListener("mousedown",H),console.log("Componente CsvPreview CONTESTUALIZZATO montato.")}),yt(()=>{k&&k.removeEventListener("scroll",ee),document.removeEventListener("mousedown",H),console.log("Componente CsvPreview CONTESTUALIZZATO smontato.")});function J(){O(),(f.fileData?.headers??[]).length>0?(console.log(f.fileData),Ae("mapping")):console.warn("Impossibile procedere: dati/headers mancanti nel context.")}return[(()=>{var r=a(Tt),e=r.firstChild,t=e.nextSibling,n=t.firstChild,x=n.nextSibling,[p,M]=c(x.nextSibling);p.nextSibling;var y=t.nextSibling,I=y.firstChild,W=I.firstChild,le=W.firstChild,xe=le.firstChild,Q=le.nextSibling;l(t,()=>g.rows?.length||0,p,M);var _e=k;return typeof _e=="function"?Ne(_e,y):k=y,m!=null?y.style.setProperty("width",m):y.style.removeProperty("width"),I.style.setProperty("position","relative"),W.style.setProperty("position","absolute"),W.style.setProperty("width","100%"),l(xe,i(de,{get each(){return g.headers},children:U=>(()=>{var T=a(kt);return we(T,`${A} ...`),l(T,U),T})()})),l(Q,i(de,{get each(){return pe()},children:(U,T)=>(()=>{var R=a(zt);return`${N}px`!=null?R.style.setProperty("height",`${N}px`):R.style.removeProperty("height"),l(R,i(de,{get each(){return g.headers},children:b=>{const ye=V(()=>z()+T()),X=V(()=>{const j=E();return j!==null&&j.visibleRowIndex===T()&&j.header===b}),Ie=V(()=>{const j=h(),S=ye();return j?.[S]?.[b]??""});return(()=>{var j=a(At);return we(j,`${A} border-gray-200`),j.style.setProperty("position","relative"),l(j,i(P,{get when(){return X()},get fallback(){return(()=>{var S=a(Lt);return S.$$click=()=>Ee(T(),b),l(S,Ie),L(()=>Xe(S,"title",`Riga ${ye()}, Colonna ${b}`)),K(),S})()},get children(){var S=a(Nt);return S.$$mousedown=oe=>oe.stopPropagation(),S.$$click=oe=>oe.stopPropagation(),Ne(oe=>setTimeout(()=>oe.focus(),0),S),S.$$keydown=d,S.addEventListener("blur",he),L(()=>Y(S,"value",Ie())),K(),S}})),L(S=>(S=X()?"0":void 0)!=null?j.style.setProperty("padding",S):j.style.removeProperty("padding")),j})()}})),R})()})),L(U=>{var T=`${$()}px`,R=`${be()}px`,b=`${z()*N}px`;return T!==U.e&&((U.e=T)!=null?y.style.setProperty("height",T):y.style.removeProperty("height")),R!==U.t&&((U.t=R)!=null?I.style.setProperty("height",R):I.style.removeProperty("height")),b!==U.a&&((U.a=b)!=null?W.style.setProperty("top",b):W.style.removeProperty("top")),U},{e:void 0,t:void 0,a:void 0}),r})(),(()=>{var r=a(Pt),e=r.firstChild,t=e.nextSibling,n=t.firstChild,x=n.nextSibling,[p,M]=c(x.nextSibling);return re(n,"click",Ye,!0),l(t,i(P,{when:typeof Pe<"u",get fallback(){return(()=>{var y=a(Vt);return y.$$click=J,K(),y})()},get children(){return i(Pe,{onClick:J,text:"Procedi con la mappatura"})}}),p,M),K(),r})()]};Le(["click","keydown","mousedown"]);var Ft=o('<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">'),Ot=o('<div><p class="font-medium mb-2">Interpretazione del segno:</p><div class="flex items-center space-x-4"><label class="flex items-center"><input type=radio name=signInterpretation value=negativeIsExpense><span class=ml-2>Importi negativi = Uscite, Importi positivi = Entrate</span></label></div><div class="flex items-center space-x-4 mt-2"><label class="flex items-center"><input type=radio name=signInterpretation value=negativeIsIncome><span class=ml-2>Importi negativi = Entrate, Importi positivi = Uscite'),Ht=o('<div class=space-y-3><div><label class="block font-medium mb-1">Colonna che indica il tipo:</label><select class="w-full p-2 border rounded"><option value>-- Seleziona colonna --</option><!$><!/></select></div><div class="grid grid-cols-2 gap-4"><div><label class="block font-medium mb-1">Valore per Entrate:</label><input type=text class="w-full p-2 border rounded"placeholder="es. entrata, income, guadagno"></div><div><label class="block font-medium mb-1">Valore per Uscite:</label><input type=text class="w-full p-2 border rounded"placeholder="es. uscita, expense, spesa">'),Ut=o(`<div class="mt-2 p-4 bg-gray-50 rounded-lg overflow-x-auto"><p class="text-xs text-gray-600 mb-2">Questa è un'anteprima di come verranno interpretati i dati in base alla mappatura e alla logica del tipo transazione attuale. 'N/D' significa che il valore nella riga originale era vuoto o nullo. 'Non Mappato' significa che il campo sistema non è stato associato a nessuna colonna CSV.</p><table class="w-full min-w-max text-sm"> <thead><tr class="border-b-2 border-gray-300 text-left"><!$><!/><th class="p-2 font-semibold">Interpretazione</th> </tr></thead><tbody>`),jt=o(`<p class="mt-2 text-sm text-orange-600">Per vedere l'anteprima dell'interpretazione, mappa prima il campo "Amount".`),Bt=o('<div class=mt-4><button class="text-blue-600 hover:text-blue-800 text-sm flex items-center"><!$><!/>Mostra anteprima dati interpretati (prime 5 righe)</button><!$><!/><!$><!/>'),Wt=o(`<div class="p-6 border rounded-lg shadow-lg mb-6 bg-white"><h2 class="text-2xl font-bold mb-3">Mappatura Colonne</h2><p class="text-sm text-gray-600 mb-4">Trascina le colonne del CSV nei campi del sistema corrispondenti</p><!$><!/><div class="flex gap-6"><div class="w-1/2 bg-gray-50 p-4 rounded-lg"><h3 class="text-lg font-semibold mb-3">Colonne CSV</h3><p class="text-sm text-gray-500 mb-3">Trascina queste colonne nei campi a destra</p><div class=space-y-2></div></div><div class="w-1/2 bg-gray-50 p-4 rounded-lg"><h3 class="text-lg font-semibold mb-3">Campi Sistema</h3><p class="text-sm text-gray-500 mb-3">Rilascia le colonne CSV qui</p><div class=space-y-2><!$><!/><div><div class="flex justify-between items-center"><span class="font-medium text-gray-500">Non utilizzare</span><div class="flex flex-wrap gap-1 max-w-xs"></div></div></div></div></div></div><div class="mt-6 p-4 bg-gray-50 rounded-lg"><h3 class="text-lg font-semibold mb-3">Configurazione Tipo Transazione</h3><div class=space-y-4><div><p class="font-medium mb-2">Come determinare se una transazione è un'entrata o un'uscita?</p><div class="flex items-center space-x-4"><label class="flex items-center"><input type=radio name=transactionType value=auto><span class=ml-2>Dal segno dell'importo</span></label><label class="flex items-center"><input type=radio name=transactionType value=column><span class=ml-2>Da una colonna specifica</span></label></div></div><!$><!/><!$><!/></div></div><div class=mt-4><button class="text-blue-600 hover:text-blue-800 text-sm flex items-center"><!$><!/>Mostra anteprima interpretazione transazioni</button><!$><!/></div><div class="mt-6 flex justify-between"><button class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">Annulla</button><!$><!/></div><div class="mt-4 text-sm text-gray-500"><p>* I campi contrassegnati sono obbligatori`),Gt=o('<button class="text-gray-600 hover:text-red-600"title="Rimuovi mappatura">✕'),qt=o('<div><div class="flex justify-between items-center"><span></span><!$><!/>'),Zt=o('<div class="flex items-center"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2"></span><button class="text-gray-500 hover:text-red-600"title="Rimuovi mappatura">✕'),Jt=o('<div><div class="flex justify-between items-center"><div><span class=font-medium></span><!$><!/></div><!$><!/>'),Kt=o('<span class="text-red-500 ml-1">*'),Qt=o('<span class="bg-gray-200 text-gray-700 px-2 py-1 rounded text-xs flex items-center"><!$><!/><button class="ml-1 text-gray-500 hover:text-red-600">✕'),Xt=o("<option>"),Yt=o('<th class="p-2 font-semibold">'),el=o('<tr class="border-b border-gray-200"><td class=p-2></td><td class=p-2></td><td class=p-2></td><td class=p-2></td><td>');function tl(g){const N=[{id:"cause",label:"Cause"},{id:"amount",label:"Amount"},{id:"currency",label:"Currency"},{id:"date",label:"Date"}],ae=["amount","walletId","currency"],m=["cause","amount","currency","date"],[A,h]=ie({}),[_,E]=ie(null),[u,D]=ie(null),[ue,k]=ie(null),[$,$e]=ie({mode:"auto",negativeIsExpense:!0}),[z,pe]=ie(!1);V(()=>{const e=Object.values(A()),t=ae.every(n=>e.includes(n));return $().mode==="column"?t&&!!$().columnName&&!!$().positiveValue&&!!$().negativeValue:t});const be=e=>t=>{if(E(e),t.dataTransfer){t.dataTransfer.effectAllowed="move";try{t.dataTransfer.setData("text/plain",e)}catch(n){console.error("Error setting drag data:",n)}}},ee=e=>t=>{t.preventDefault(),D(e),t.dataTransfer&&(t.dataTransfer.dropEffect="move")},te=()=>{D(null)},O=e=>t=>{t.preventDefault();const n=_();n&&h(x=>{const p={...x};return p[n]&&p[n]===e?(D(null),E(null),x):(Object.keys(p).forEach(M=>{p[M]===e&&delete p[M]}),p[n]=e,p)}),D(null),E(null)},Ee=e=>{h(t=>{const n={...t};return Object.keys(n).forEach(x=>{n[x]===e&&delete n[x]}),n})},he=e=>{h(t=>{const n={...t};return delete n[e],n})},d=e=>{$e(t=>({...t,...e}))},H=async()=>{console.log("eee");try{const e=A(),t=$();console.log("sent"),await Ve.api.post("API/Wallets/Wallet/addTransactionByFile/addTransactions",{columnMapping:e,transactionTypeLogic:t}),g.onMappingComplete(e,t)}catch(e){console.error("Errore durante l'invio della mappatura:",e),k(e.message||"Errore durante l'invio della mappatura")}},J=e=>{const n=Object.entries(A()).find(([x,p])=>typeof p=="string"&&p.trim()===e);return n?n[0]:null},r=V(()=>{console.log("Calculating transactionExamples (detailed)...");const e=A();if(!g.rows||g.rows.length===0)return console.log("DEBUG Memo: props.rows è vuoto."),[];const t={};m.forEach(I=>{t[I]=Object.entries(e).find(([W,le])=>typeof le=="string"&&le.trim()===I)?.[0]});const n=g.rows.slice(0,5),x="amount";console.log(`DEBUG Memo: Cerco il valore ID: "${x}" (Tipo: string)`);const p=Object.entries(e);console.log("DEBUG Memo: Controllo queste entries:",JSON.stringify(p)),p.forEach(([I,W])=>{const Q=(typeof W==="string"?W.trim():W)===x;console.log(`-- DEBUG Memo Entry: Chiave="<span class="math-inline">{key}", Valore="</span>{value}" (Tipo: <span class="math-inline">{valueType}). Confronto diretto ('</span>{amountFieldId}'): <span class="math-inline">{directMatch}. Confronto con trim ('</span>{amountFieldId}'): ${Q}`)});const M=t.amount;if(!M)return console.log("DEBUG Memo: Amount header non mappato, impossibile calcolare esempi completi."),[];if(console.log("DEBUG: Header mappato per 'amount' (Risultato finale find):",M),!M)return console.log("DEBUG Memo: Amount header NON trovato, ritorno array vuoto."),[];console.log(`DEBUG Memo: Amount header trovato: "${M}". Calcolo esempi...`);const y=n.map((I,W)=>{const le=t.walletId?I[t.walletId]??"N/D":"Non Mappato",xe=t.cause?I[t.cause]??"N/D":"Non Mappato",Q=t.currency?I[t.currency]??"N/D":"Non Mappato",_e=t.date?I[t.date]??"N/D":"Non Mappato",U=I[M],T=parseFloat(U);let R="Non determinato";const b=$();if(b.mode==="auto")R=T<0===b.negativeIsExpense?"Uscita":"Entrata";else if(b.mode==="column"&&b.columnName&&b.positiveValue&&b.negativeValue){const X=I[b.columnName];X===b.positiveValue?R="Entrata":X===b.negativeValue&&(R="Uscita")}const ye=Q&&Q!=="Non Mappato"&&Q!=="N/D"?Q:"EUR";return{walletId:le,cause:xe,amount:isNaN(T)?"N/A":new Intl.NumberFormat("it-IT",{style:"currency",currency:ye}).format(T),currency:Q,date:_e,interpretation:R}});return console.log(`DEBUG: Esempi dettagliati calcolati: ${y.length}`),y});return(()=>{var e=a(Wt),t=e.firstChild,n=t.nextSibling,x=n.nextSibling,[p,M]=c(x.nextSibling),y=p.nextSibling,I=y.firstChild,W=I.firstChild,le=W.nextSibling,xe=le.nextSibling,Q=I.nextSibling,_e=Q.firstChild,U=_e.nextSibling,T=U.nextSibling,R=T.firstChild,[b,ye]=c(R.nextSibling),X=b.nextSibling,Ie=X.firstChild,j=Ie.firstChild,S=j.nextSibling,oe=y.nextSibling,et=oe.firstChild,ke=et.nextSibling,Re=ke.firstChild,tt=Re.firstChild,lt=tt.nextSibling,Fe=lt.firstChild,Oe=Fe.firstChild,nt=Fe.nextSibling,He=nt.firstChild,rt=Re.nextSibling,[Ue,it]=c(rt.nextSibling),at=Ue.nextSibling,[ot,st]=c(at.nextSibling),ze=oe.nextSibling,Te=ze.firstChild,ct=Te.firstChild,[je,dt]=c(ct.nextSibling);je.nextSibling;var ut=Te.nextSibling,[pt,gt]=c(ut.nextSibling),Be=ze.nextSibling,We=Be.firstChild,mt=We.nextSibling,[$t,bt]=c(mt.nextSibling);return l(e,i(P,{get when(){return ue()},get children(){var s=a(Ft);return l(s,ue),s}}),p,M),l(xe,i(de,{get each(){return g.csvHeaders},children:s=>{const C=V(()=>Object.keys(A()).includes(s));return(()=>{var w=a(qt),v=w.firstChild,F=v.firstChild,G=F.nextSibling,[q,ne]=c(G.nextSibling);return re(w,"dragstart",be(s)),l(F,s),l(v,i(P,{get when(){return C()},get children(){var B=a(Gt);return B.$$click=()=>he(s),K(),B}}),q,ne),L(B=>{var se=`p-3 rounded-md cursor-grab ${C()?"bg-gray-300 text-gray-600":"bg-blue-100 hover:bg-blue-200 text-blue-800"}`,ge=!C();return se!==B.e&&we(w,B.e=se),ge!==B.t&&Xe(w,"draggable",B.t=ge),B},{e:void 0,t:void 0}),w})()}})),l(T,i(de,{each:N,children:s=>{const C=V(()=>J(s.id)),w=ae.includes(s.id);return(()=>{var v=a(Jt),F=v.firstChild,G=F.firstChild,q=G.firstChild,ne=q.nextSibling,[B,se]=c(ne.nextSibling),ge=G.nextSibling,[ve,De]=c(ge.nextSibling);return re(v,"drop",O(s.id)),v.addEventListener("dragleave",te),re(v,"dragover",ee(s.id)),l(q,()=>s.label),l(G,w&&a(Kt),B,se),l(F,i(P,{get when(){return C()},get children(){var Se=a(Zt),fe=Se.firstChild,Z=fe.nextSibling;return l(fe,C),Z.$$click=()=>Ee(s.id),K(),Se}}),ve,De),L(()=>we(v,`p-3 rounded-md border-2 ${u()===s.id?"border-blue-500 bg-blue-50":C()?"border-green-500 bg-green-50":w?"border-yellow-300 bg-yellow-50":"border-gray-300 bg-white"}`)),v})()}}),b,ye),re(X,"drop",O("non_utilizzare")),X.addEventListener("dragleave",te),re(X,"dragover",ee("non_utilizzare")),l(S,i(de,{get each(){return Object.entries(A())},children:([s,C])=>i(P,{when:C==="non_utilizzare",get children(){var w=a(Qt),v=w.firstChild,[F,G]=c(v.nextSibling),q=F.nextSibling;return l(w,s,F,G),q.$$click=()=>he(s),K(),w}})})),Oe.addEventListener("change",()=>d({mode:"auto"})),He.addEventListener("change",()=>d({mode:"column"})),l(ke,i(P,{get when(){return $().mode==="auto"},get children(){var s=a(Ot),C=s.firstChild,w=C.nextSibling,v=w.firstChild,F=v.firstChild,G=w.nextSibling,q=G.firstChild,ne=q.firstChild;return F.addEventListener("change",()=>d({negativeIsExpense:!0})),ne.addEventListener("change",()=>d({negativeIsExpense:!1})),L(()=>Y(F,"checked",$().negativeIsExpense===!0)),L(()=>Y(ne,"checked",$().negativeIsExpense===!1)),s}}),Ue,it),l(ke,i(P,{get when(){return $().mode==="column"},get children(){var s=a(Ht),C=s.firstChild,w=C.firstChild,v=w.nextSibling,F=v.firstChild,G=F.nextSibling,[q,ne]=c(G.nextSibling),B=C.nextSibling,se=B.firstChild,ge=se.firstChild,ve=ge.nextSibling,De=se.nextSibling,Se=De.firstChild,fe=Se.nextSibling;return v.addEventListener("change",Z=>d({columnName:Z.currentTarget.value})),l(v,i(de,{get each(){return g.csvHeaders},children:Z=>(()=>{var Ce=a(Xt);return Y(Ce,"value",Z),l(Ce,Z),Ce})()}),q,ne),ve.addEventListener("change",Z=>d({positiveValue:Z.currentTarget.value})),fe.addEventListener("change",Z=>d({negativeValue:Z.currentTarget.value})),L(()=>Y(v,"value",$().columnName||"")),L(()=>Y(ve,"value",$().positiveValue||"")),L(()=>Y(fe,"value",$().negativeValue||"")),s}}),ot,st),Te.$$click=()=>pe(!z()),l(Te,()=>z()?"▼ ":"► ",je,dt),l(ze,i(P,{get when(){return z()},get children(){var s=a(Bt),C=s.firstChild,w=C.firstChild,[v,F]=c(w.nextSibling);v.nextSibling;var G=C.nextSibling,[q,ne]=c(G.nextSibling),B=q.nextSibling,[se,ge]=c(B.nextSibling);return C.$$click=()=>pe(!z()),l(C,()=>z()?"▼ ":"► ",v,F),l(s,i(P,{get when(){return V(()=>!!z())()&&r().length>0},get children(){var ve=a(Ut),De=ve.firstChild,Se=De.nextSibling,fe=Se.firstChild,Z=fe.nextSibling,Ce=Z.firstChild,vt=Ce.firstChild,[Ge,ft]=c(vt.nextSibling);Ge.nextSibling;var ht=Z.nextSibling;return l(Ce,i(de,{each:N,children:ce=>(()=>{var Me=a(Yt);return l(Me,()=>ce.label),Me})()}),Ge,ft),l(ht,i(de,{get each(){return r()},children:ce=>(()=>{var Me=a(el),qe=Me.firstChild,Ze=qe.nextSibling,Je=Ze.nextSibling,Ke=Je.nextSibling,Qe=Ke.nextSibling;return l(qe,()=>ce.cause),l(Ze,()=>ce.amount),l(Je,()=>ce.currency),l(Ke,()=>ce.date),l(Qe,()=>ce.interpretation),L(()=>we(Qe,`p-2 font-medium ${ce.interpretation==="Entrata"?"text-green-600":ce.interpretation==="Uscita"?"text-red-600":"text-gray-600"}`)),Me})()})),ve}}),q,ne),l(s,i(P,{get when(){return V(()=>!!z())()&&!J("amount")},get children(){return a(jt)}}),se,ge),K(),s}}),pt,gt),re(We,"click",g.onCancel,!0),l(Be,i(Pe,{onClick:H,text:"Conferma mappatura"}),$t,bt),L(()=>we(X,`p-3 rounded-md border-2 ${u()==="non_utilizzare"?"border-red-500 bg-red-50":"border-gray-300 bg-white"}`)),L(()=>Y(Oe,"checked",$().mode==="auto")),L(()=>Y(He,"checked",$().mode==="column")),K(),e})()}Le(["click"]);var ll=o("<p>"),nl=o("<div class=CM><h1>Carica Estratto Conto (CSV)</h1><form enctype=multipart/form-data><div><label for=csv-file-input class=text-white>Seleziona file CSV:</label><input id=csv-file-input type=file name=csv accept=.csv required></div><!$><!/></form><!$><!/>");function rl(){const[g,N]=ie(null),ae=V(()=>!g());let m;function A(_){const u=_.currentTarget.files?.[0];u?u.name.toLowerCase().endsWith(".csv")?(N(u),me(null)):(N(null),me("Errore: Il file selezionato non è un CSV. Per favore, scegli un file con estensione .csv."),m&&(m.value="")):(N(null),me(null))}async function h(_){_.preventDefault();const E=g();if(E)try{const u=new FormData;u.append("file",E);const D=await Ve.api.post("API/Wallets/Wallet/addTransactionByFile/uploadFile",u,{headers:{"Content-Type":"multipart/form-data"}});D.data&&Array.isArray(D.data.headers)&&Array.isArray(D.data.rows)?(Ct({headers:D.data.headers,rows:D.data.rows}),console.log("File caricato e stato inizializzato. Step attuale:",f.currentStep)):(console.error("Risposta API non contiene headers o rows validi:",D.data),me("Risposta dal server non valida o malformata (mancano headers/rows)."))}catch(u){console.error(u),me("Errore durante l'upload: "+u.message)}}return(()=>{var _=a(nl),E=_.firstChild,u=E.nextSibling,D=u.firstChild,ue=D.firstChild,k=ue.nextSibling,$=D.nextSibling,[$e,z]=c($.nextSibling),pe=u.nextSibling,[be,ee]=c(pe.nextSibling);u.addEventListener("submit",h),k.addEventListener("change",A);var te=m;return typeof te=="function"?Ne(te,k):m=k,l(u,i(Pe,{type:"submit",get disabled(){return ae()},text:"Submit file"}),$e,z),l(_,i(P,{get when(){return f.errorMessage},get children(){var O=a(ll);return O.style.setProperty("color","red"),O.style.setProperty("margin-top","10px"),l(O,()=>f.errorMessage),O}}),be,ee),_})()}var il=o(`<div class="my-4 flex justify-start space-x-2"><button class="px-3 py-1 text-sm bg-red-100 text-red-800 rounded hover:bg-red-200 disabled:opacity-50 disabled:cursor-not-allowed"title="Annulla tutte le modifiche fatte nella tabella">Resetta Modifiche Tabella</button><button class="px-3 py-1 text-sm bg-yellow-100 text-yellow-800 rounded hover:bg-yellow-200 disabled:opacity-50 disabled:cursor-not-allowed"title="Annulla l'ultima modifica fatta nella tabella">Annulla Ultima Modifica`),al=o("<div class=mt-300>"),ol=o('<div class="mt-4 flex justify-between"><button class="px-4 py-2 bg-gray-200 rounded">Indietro'),sl=o('<div><h2 class="text-2xl font-bold text-green-600">Importazione Completata!</h2><button class="mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Inizia Nuovo Import'),cl=o('<div class="mt-4 p-4 bg-red-100 text-red-700 border border-red-400 rounded"><strong>Errore:</strong> <!$><!/>'),dl=o('<div class="container mx-auto p-4"><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>');function Tl(){Mt(!1);const g=V(()=>(f.history?.length||0)>0);function N(){Ae("preview")}async function ae(m,A){if(console.log("MAP COMPLETE: Ricevuti mapping e logic",m,A),!f.fileData||!f.fileData.rows){console.error("Errore critico: fileData non disponibile al momento dell'import finale."),me("Errore: Dati del file non trovati per l'importazione finale.");return}try{Dt(m);const h={rowsToImport:f.fileData.rows,columnMapping:m,transactionTypeLogic:A};console.log("MAP COMPLETE: Invio payload finale all'API:",h);const _=await Ve.api.post("API/Wallets/Wallet/addTransactionByFile/importMappedData",h);console.log("MAP COMPLETE: Risposta API importazione finale:",_),_.status===200||_.status===201?Ae("complete"):(console.error("Importazione fallita:",_),me(_.data?.message||"Errore sconosciuto durante l'importazione finale."))}catch(h){console.error("Errore durante l'invio/importazione dei dati finali:",h),me(h.response?.data?.message||h.message||"Errore di rete o del server durante l'importazione finale.")}}return(()=>{var m=a(dl),A=m.firstChild,[h,_]=c(A.nextSibling),E=h.nextSibling,[u,D]=c(E.nextSibling),ue=u.nextSibling,[k,$]=c(ue.nextSibling),$e=k.nextSibling,[z,pe]=c($e.nextSibling),be=z.nextSibling,[ee,te]=c(be.nextSibling),O=ee.nextSibling,[Ee,he]=c(O.nextSibling);return l(m,i(P,{get when(){return f.currentStep==="preview"},get children(){var d=a(il),H=d.firstChild,J=H.nextSibling;return re(H,"click",wt,!0),re(J,"click",Et,!0),L(r=>{var e=!g(),t=!g();return e!==r.e&&Y(H,"disabled",r.e=e),t!==r.t&&Y(J,"disabled",r.t=t),r},{e:void 0,t:void 0}),K(),d}}),h,_),l(m,i(P,{get when(){return f.currentStep==="upload"},get children(){return[i(rl,{}),(()=>{var d=a(al);return l(d,i(It,{})),d})()]}}),u,D),l(m,i(P,{get when(){return f.currentStep==="preview"&&f.fileData},get children(){return i(Rt,{get headers(){return f.fileData?.headers||[]},get rows(){return f.fileData?.rows||[]},tableHeight:600,tableWidth:"100%",rowHeight:48,cellPadding:"py-3 px-4"})}}),k,$),l(m,i(P,{get when(){return f.currentStep==="mapping"},get children(){return[i(tl,{get csvHeaders(){return f.fileData?.headers||[]},onMappingComplete:ae,onCancel:N,get rows(){return f.fileData?.rows||[]}}),(()=>{var d=a(ol),H=d.firstChild;return H.$$click=N,K(),d})()]}}),z,pe),l(m,i(P,{get when(){return f.currentStep==="complete"},get children(){var d=a(sl),H=d.firstChild,J=H.nextSibling;return re(J,"click",Ye,!0),K(),d}}),ee,te),l(m,i(P,{get when(){return f.errorMessage},get children(){var d=a(cl),H=d.firstChild,J=H.nextSibling,r=J.nextSibling,[e,t]=c(r.nextSibling);return l(d,()=>f.errorMessage,e,t),d}}),Ee,he),m})()}Le(["click"]);export{Tl as default};
