import{g as h,t as f,b as K,i as v,j as de,r as D,u as X,d as ue,c as q,e as ge,a as pe}from"./web-DpIebe6J.js";import{k as R,f as m,p as he,n as ve,o as me,a as C,d as T,F as I,S as G}from"./solid-DuWri35y.js";import{r as fe,c as J,s as ye,u as be}from"./context-DGrJV8BX.js";import{B as Q}from"./ButtonSparkle-B8MvXRxa.js";import"./store-EkIb7068.js";var $e=f('<div class="p-6 border rounded-lg shadow-lg mb-6 bg-white"><h2 class="text-2xl font-bold mb-3">Anteprima Dati (Contestualizzata)</h2><p class="text-sm text-gray-600 mb-4">Dataset con <!$><!/> righe totali - <span class="font-medium text-blue-600">Clicca su una cella per modificare</span>(Salvataggio automatico uscendo dalla cella)</p><div class="overflow-auto border border-gray-200 rounded-lg relative"><div><table class="w-full bg-white border-separate border-spacing-0"><thead class="sticky top-0 z-10 bg-gray-100"><tr></tr></thead><tbody></tbody></table></div></div><div class="mt-4 text-sm text-gray-500"><p>Scorri per visualizzare più righe. Clicca una cella per modificarla (Invio salva ed esce, Esc annulla, click su altra cella/fuori salva).'),xe=f(`<div class="mt-6 flex justify-end items-center"> <div class="flex space-x-2"><button class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300"title="Annulla l'intero processo di importazione">Annulla Processo</button><!$><!/>`),we=f("<th>"),Ce=f('<tr class="hover:bg-gray-50 border-b border-gray-200">'),_e=f('<input type=text class="w-full h-full px-4 py-3 ...">'),Pe=f("<td>"),Se=f('<div class="w-full h-full flex items-center cursor-pointer">'),Ee=f('<button class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Procedi');const He=c=>{const b=c.rowHeight||48,H=c.tableHeight||800,A=c.tableWidth||"100%",L=c.cellPadding||"py-3 px-4",[P,Y]=R([]),[$,M]=R(null),[ee,te]=R(0);let d;const z=m(()=>typeof window<"u"?Math.min(H,window.innerHeight*.8):H),re=m(()=>Math.ceil(z()/b)+5),S=m(()=>Math.max(0,Math.floor(ee()/b))),le=m(()=>{const e=P();if(!e)return[];const t=S(),r=re(),n=Math.min(t+r,e.length);return e.slice(t,n)}),ne=m(()=>P()?.length*b||0);he(()=>{const t=c.rows?.map(r=>({...r}))||[];Y(t)});const N=e=>{te(e.target.scrollTop)},O=(e,t,r)=>{const n=S()+e,u=P();if(!u||n<0||n>=u.length){console.error("saveDataToContext: Indice riga non valido o dati non pronti:",n);return}const x=u[n]?.[t];if(String(x??"")===String(r??""))return;const y=[...u],o={...y[n]};o[t]=r,y[n]=o,console.log(`✅ Dati pronti per CONTEXT => Riga Assoluta: ${n}, Header: "${t}", Nuovo Valore: "${r}"`),be(y)},E=()=>{$()!==null&&M(null)},oe=(e,t)=>{const r=$();r?.visibleRowIndex===e&&r?.header===t||M({visibleRowIndex:e,header:t})},ae=e=>{const t=$();t&&O(t.visibleRowIndex,t.header,e.target.value)},se=e=>{const t=$();t&&(e.key==="Enter"?(e.preventDefault(),O(t.visibleRowIndex,t.header,e.target.value),E()):e.key==="Escape"&&E())},Z=e=>{$()&&d&&!d.contains(e.target)&&E()};ve(()=>{d&&d.addEventListener("scroll",N),document.addEventListener("mousedown",Z),console.log("Componente CsvPreview CONTESTUALIZZATO montato.")}),me(()=>{d&&d.removeEventListener("scroll",N),document.removeEventListener("mousedown",Z),console.log("Componente CsvPreview CONTESTUALIZZATO smontato.")});function B(){E(),(J.fileData?.headers??[]).length>0?(console.log(J.fileData),ye("mapping")):console.warn("Impossibile procedere: dati/headers mancanti nel context.")}return[(()=>{var e=h($e),t=e.firstChild,r=t.nextSibling,n=r.firstChild,u=n.nextSibling,[x,y]=K(u.nextSibling);x.nextSibling;var o=r.nextSibling,k=o.firstChild,_=k.firstChild,F=_.firstChild,ie=F.firstChild,ce=F.nextSibling;v(r,()=>c.rows?.length||0,x,y);var W=d;return typeof W=="function"?X(W,o):d=o,A!=null?o.style.setProperty("width",A):o.style.removeProperty("width"),k.style.setProperty("position","relative"),_.style.setProperty("position","absolute"),_.style.setProperty("width","100%"),v(ie,C(I,{get each(){return c.headers},children:i=>(()=>{var s=h(we);return q(s,`${L} ...`),v(s,i),s})()})),v(ce,C(I,{get each(){return le()},children:(i,s)=>(()=>{var g=h(Ce);return`${b}px`!=null?g.style.setProperty("height",`${b}px`):g.style.removeProperty("height"),v(g,C(I,{get each(){return c.headers},children:p=>{const j=m(()=>S()+s()),U=m(()=>{const a=$();return a!==null&&a.visibleRowIndex===s()&&a.header===p}),V=m(()=>{const a=P(),l=j();return a?.[l]?.[p]??""});return(()=>{var a=h(Pe);return q(a,`${L} border-gray-200`),a.style.setProperty("position","relative"),v(a,C(G,{get when(){return U()},get fallback(){return(()=>{var l=h(Se);return l.$$click=()=>oe(s(),p),v(l,V),T(()=>pe(l,"title",`Riga ${j()}, Colonna ${p}`)),D(),l})()},get children(){var l=h(_e);return l.$$mousedown=w=>w.stopPropagation(),l.$$click=w=>w.stopPropagation(),X(w=>setTimeout(()=>w.focus(),0),l),l.$$keydown=se,l.addEventListener("blur",ae),T(()=>ge(l,"value",V())),D(),l}})),T(l=>(l=U()?"0":void 0)!=null?a.style.setProperty("padding",l):a.style.removeProperty("padding")),a})()}})),g})()})),T(i=>{var s=`${z()}px`,g=`${ne()}px`,p=`${S()*b}px`;return s!==i.e&&((i.e=s)!=null?o.style.setProperty("height",s):o.style.removeProperty("height")),g!==i.t&&((i.t=g)!=null?k.style.setProperty("height",g):k.style.removeProperty("height")),p!==i.a&&((i.a=p)!=null?_.style.setProperty("top",p):_.style.removeProperty("top")),i},{e:void 0,t:void 0,a:void 0}),e})(),(()=>{var e=h(xe),t=e.firstChild,r=t.nextSibling,n=r.firstChild,u=n.nextSibling,[x,y]=K(u.nextSibling);return de(n,"click",fe,!0),v(r,C(G,{when:typeof Q<"u",get fallback(){return(()=>{var o=h(Ee);return o.$$click=B,D(),o})()},get children(){return C(Q,{onClick:B,text:"Procedi con la mappatura"})}}),x,y),D(),e})()]};ue(["click","keydown","mousedown"]);export{He as default};
