import{ssr as l,ssrHydrationKey as n,escape as t,createComponent as s,ssrAttribute as O}from"solid-js/web";import{createSignal as m,createMemo as o,createEffect as L,onMount as Z,onCleanup as B,For as b,Show as $}from"solid-js";import{c as S,s as F}from"./assets/context-XUFMQc9R.js";import{B as E}from"./assets/ButtonSparkle-BxHzGCPC.js";import"solid-js/store";var N=["<div",' class="p-6 border rounded-lg shadow-lg mb-6 bg-white"><h2 class="text-2xl font-bold mb-3">Anteprima Dati (Contestualizzata)</h2><p class="text-sm text-gray-600 mb-4">Dataset con <!--$-->','<!--/--> righe totali - <span class="font-medium text-blue-600">Clicca su una cella per modificare</span>(Salvataggio automatico uscendo dalla cella)</p><div class="overflow-auto border border-gray-200 rounded-lg relative" style="','"><div style="','"><table class="w-full bg-white border-separate border-spacing-0" style="','"><thead class="sticky top-0 z-10 bg-gray-100"><tr>',"</tr></thead><tbody>",'</tbody></table></div></div><div class="mt-4 text-sm text-gray-500"><p>Scorri per visualizzare pi√π righe. Clicca una cella per modificarla (Invio salva ed esce, Esc annulla, click su altra cella/fuori salva).</p></div></div>'],U=["<div",` class="mt-6 flex justify-end items-center"> <div class="flex space-x-2"><button class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300" title="Annulla l'intero processo di importazione">Annulla Processo</button><!--$-->`,"<!--/--></div></div>"],V=["<th",' class="','">',"</th>"],W=["<tr",' class="hover:bg-gray-50 border-b border-gray-200" style="','">',"</tr>"],j=["<input",' type="text" class="w-full h-full px-4 py-3 ..."',">"],K=["<td",' class="','" style="','">',"</td>"],q=["<div",' class="w-full h-full flex items-center cursor-pointer" title="','">',"</div>"],G=["<button",' class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Procedi</button>'];const lt=e=>{const c=e.rowHeight||48,v=e.tableHeight||800,P=e.tableWidth||"100%",f=e.cellPadding||"py-3 px-4",[g,T]=m([]),[p,A]=m(null),[D,J]=m(0);let H;const w=o(()=>typeof window<"u"?Math.min(v,window.innerHeight*.8):v),M=o(()=>Math.ceil(w()/c)+5),h=o(()=>Math.max(0,Math.floor(D()/c))),_=o(()=>{const a=g();if(!a)return[];const r=h(),i=M(),u=Math.min(r+i,a.length);return a.slice(r,u)}),k=o(()=>g()?.length*c||0);L(()=>{const r=e.rows?.map(i=>({...i}))||[];T(r)});const z=()=>{p()!==null&&A(null)},x=a=>{p()};Z(()=>{document.addEventListener("mousedown",x),console.log("Componente CsvPreview CONTESTUALIZZATO montato.")}),B(()=>{document.removeEventListener("mousedown",x),console.log("Componente CsvPreview CONTESTUALIZZATO smontato.")});function I(){z(),(S.fileData?.headers??[]).length>0?(console.log(S.fileData),F("mapping")):console.warn("Impossibile procedere: dati/headers mancanti nel context.")}return[l(N,n(),t(e.rows?.length)||0,`height:${t(w(),!0)}px`+(";width:"+t(P,!0)),`height:${t(k(),!0)}px;position:relative`,`position:absolute;top:${t(h(),!0)*t(c,!0)}px;width:100%`,t(s(b,{get each(){return e.headers},children:a=>l(V,n(),`${t(f,!0)} ...`,t(a))})),t(s(b,{get each(){return _()},children:(a,r)=>l(W,n(),`height:${t(c,!0)}px`,t(s(b,{get each(){return e.headers},children:i=>{const u=o(()=>h()+r()),y=o(()=>{const d=p();return d!==null&&d.visibleRowIndex===r()&&d.header===i}),C=o(()=>{const d=g(),R=u();return d?.[R]?.[i]??""});return l(K,n(),`${t(f,!0)} border-gray-200`,"padding:"+(y()?"0":t(void 0,!0))+";position:relative",t(s($,{get when(){return y()},get fallback(){return l(q,n(),`Riga ${t(u(),!0)}, Colonna ${t(i,!0)}`,t(C()))},get children(){return l(j,n(),O("value",t(C(),!0),!1))}})))}})))}))),l(U,n(),t(s($,{when:typeof E<"u",get fallback(){return l(G,n())},get children(){return s(E,{onClick:I,text:"Procedi con la mappatura"})}})))]};export{lt as default};
