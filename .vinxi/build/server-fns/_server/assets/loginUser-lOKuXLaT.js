import{c as a}from"./server-fns-runtime-4T1EILgx.js";import{u as n}from"./fetchEvent-1KlzQMFw.js";import{d as i}from"./db.server-BYnrqg0d.js";import*as c from"bcryptjs";import"solid-js/web";import"solid-js/web/storage";import"h3";import"node:async_hooks";import"pg";const _=a(async r=>{const{password:o,username:t}=r;try{const s=await i.query("SELECT id, username, password FROM users WHERE username = $1",[t]);if(s.rows.length===0)return{success:!1,message:"Credenziali non valide"};const e=s.rows[0];return await c.compare(o,e.password)?(await(await n({password:process.env.SESSION_SECRET,name:"auth_session"})).update({userId:e.id,username:e.username}),console.log(`Sessione (cookie criptato) aggiornata per utente ${e.username}`),{success:!0}):{success:!1,message:"Credenziali non valide"}}catch(s){return console.error("Errore durante il login:",s),process.env.SESSION_SECRET?{success:!1,message:"Errore durante il processo di login"}:(console.error("SESSION_SECRET non Ã¨ impostata!"),{success:!1,message:"Errore di configurazione server."})}},"src_routes_API_Auth_login_loginUser_ts--loginUser_action","C:/Users/Matteo/Desktop/Pulsix/src/routes/API/Auth/login/loginUser.ts?tsr-directive-use-server=");export{_ as loginUser_action};
