import{g as c,b as d,i as n,j as R,r as X,t as u,d as pt,c as te,a as ut,e as I}from"./web-DpIebe6J.js";import{k as q,f as P,a as p,d as y,S as D,F as W}from"./solid-DuWri35y.js";import{B as gt}from"./ButtonSparkle-B8MvXRxa.js";import{a as mt}from"./auth-B7ef8sb9.js";import"./store-EkIb7068.js";import"./index-Ckjqp3wL.js";import"./index-BbP3371Q.js";import"./index-BAMY2Nnw.js";import"./index-CgqXENQe.js";var bt=u('<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">'),$t=u('<div><p class="font-medium mb-2">Interpretazione del segno:</p><div class="flex items-center space-x-4"><label class="flex items-center"><input type=radio name=signInterpretation value=negativeIsExpense><span class=ml-2>Importi negativi = Uscite, Importi positivi = Entrate</span></label></div><div class="flex items-center space-x-4 mt-2"><label class="flex items-center"><input type=radio name=signInterpretation value=negativeIsIncome><span class=ml-2>Importi negativi = Entrate, Importi positivi = Uscite'),vt=u('<div class=space-y-3><div><label class="block font-medium mb-1">Colonna che indica il tipo:</label><select class="w-full p-2 border rounded"><option value>-- Seleziona colonna --</option><!$><!/></select></div><div class="grid grid-cols-2 gap-4"><div><label class="block font-medium mb-1">Valore per Entrate:</label><input type=text class="w-full p-2 border rounded"placeholder="es. entrata, income, guadagno"></div><div><label class="block font-medium mb-1">Valore per Uscite:</label><input type=text class="w-full p-2 border rounded"placeholder="es. uscita, expense, spesa">'),xt=u(`<div class="mt-2 p-4 bg-gray-50 rounded-lg overflow-x-auto"><p class="text-xs text-gray-600 mb-2">Questa è un'anteprima di come verranno interpretati i dati in base alla mappatura e alla logica del tipo transazione attuale. 'N/D' significa che il valore nella riga originale era vuoto o nullo. 'Non Mappato' significa che il campo sistema non è stato associato a nessuna colonna CSV.</p><table class="w-full min-w-max text-sm"> <thead><tr class="border-b-2 border-gray-300 text-left"><!$><!/><th class="p-2 font-semibold">Interpretazione</th> </tr></thead><tbody>`),_t=u(`<p class="mt-2 text-sm text-orange-600">Per vedere l'anteprima dell'interpretazione, mappa prima il campo "Amount".`),ft=u('<div class=mt-4><button class="text-blue-600 hover:text-blue-800 text-sm flex items-center"><!$><!/>Mostra anteprima dati interpretati (prime 5 righe)</button><!$><!/><!$><!/>'),ht=u(`<div class="p-6 border rounded-lg shadow-lg mb-6 bg-white"><h2 class="text-2xl font-bold mb-3">Mappatura Colonne</h2><p class="text-sm text-gray-600 mb-4">Trascina le colonne del CSV nei campi del sistema corrispondenti</p><!$><!/><div class="flex gap-6"><div class="w-1/2 bg-gray-50 p-4 rounded-lg"><h3 class="text-lg font-semibold mb-3">Colonne CSV</h3><p class="text-sm text-gray-500 mb-3">Trascina queste colonne nei campi a destra</p><div class=space-y-2></div></div><div class="w-1/2 bg-gray-50 p-4 rounded-lg"><h3 class="text-lg font-semibold mb-3">Campi Sistema</h3><p class="text-sm text-gray-500 mb-3">Rilascia le colonne CSV qui</p><div class=space-y-2><!$><!/><div><div class="flex justify-between items-center"><span class="font-medium text-gray-500">Non utilizzare</span><div class="flex flex-wrap gap-1 max-w-xs"></div></div></div></div></div></div><div class="mt-6 p-4 bg-gray-50 rounded-lg"><h3 class="text-lg font-semibold mb-3">Configurazione Tipo Transazione</h3><div class=space-y-4><div><p class="font-medium mb-2">Come determinare se una transazione è un'entrata o un'uscita?</p><div class="flex items-center space-x-4"><label class="flex items-center"><input type=radio name=transactionType value=auto><span class=ml-2>Dal segno dell'importo</span></label><label class="flex items-center"><input type=radio name=transactionType value=column><span class=ml-2>Da una colonna specifica</span></label></div></div><!$><!/><!$><!/></div></div><div class=mt-4><button class="text-blue-600 hover:text-blue-800 text-sm flex items-center"><!$><!/>Mostra anteprima interpretazione transazioni</button><!$><!/></div><div class="mt-6 flex justify-between"><button class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">Annulla</button><!$><!/></div><div class="mt-4 text-sm text-gray-500"><p>* I campi contrassegnati sono obbligatori`),yt=u('<button class="text-gray-600 hover:text-red-600"title="Rimuovi mappatura">✕'),St=u('<div><div class="flex justify-between items-center"><span></span><!$><!/>'),Ct=u('<div class="flex items-center"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2"></span><button class="text-gray-500 hover:text-red-600"title="Rimuovi mappatura">✕'),Et=u('<div><div class="flex justify-between items-center"><div><span class=font-medium></span><!$><!/></div><!$><!/>'),wt=u('<span class="text-red-500 ml-1">*'),Mt=u('<span class="bg-gray-200 text-gray-700 px-2 py-1 rounded text-xs flex items-center"><!$><!/><button class="ml-1 text-gray-500 hover:text-red-600">✕'),Dt=u("<option>"),Nt=u('<th class="p-2 font-semibold">'),Tt=u('<tr class="border-b border-gray-200"><td class=p-2></td><td class=p-2></td><td class=p-2></td><td class=p-2></td><td>');function Bt(V){const ce=[{id:"cause",label:"Cause"},{id:"amount",label:"Amount"},{id:"currency",label:"Currency"},{id:"date",label:"Date"}],de=["amount","walletId","currency"],Le=["cause","amount","currency","date"],[O,ne]=q({}),[Ue,le]=q(null),[pe,Y]=q(null),[ue,Fe]=q(null),[g,je]=q({mode:"auto",negativeIsExpense:!0}),[k,ge]=q(!1);P(()=>{const t=Object.values(O()),e=de.every(a=>t.includes(a));return g().mode==="column"?e&&!!g().columnName&&!!g().positiveValue&&!!g().negativeValue:e});const Oe=t=>e=>{if(le(t),e.dataTransfer){e.dataTransfer.effectAllowed="move";try{e.dataTransfer.setData("text/plain",t)}catch(a){console.error("Error setting drag data:",a)}}},me=t=>e=>{e.preventDefault(),Y(t),e.dataTransfer&&(e.dataTransfer.dropEffect="move")},be=()=>{Y(null)},$e=t=>e=>{e.preventDefault();const a=Ue();a&&ne(h=>{const o={...h};return o[a]&&o[a]===t?(Y(null),le(null),h):(Object.keys(o).forEach(S=>{o[S]===t&&delete o[S]}),o[a]=t,o)}),Y(null),le(null)},Be=t=>{ne(e=>{const a={...e};return Object.keys(a).forEach(h=>{a[h]===t&&delete a[h]}),a})},ve=t=>{ne(e=>{const a={...e};return delete a[t],a})},z=t=>{je(e=>({...e,...t}))},Ae=async()=>{console.log("eee");try{const t=O(),e=g();console.log("sent"),await mt.api.post("API/Wallets/Wallet/addTransactionByFile/addTransactions",{columnMapping:t,transactionTypeLogic:e}),V.onMappingComplete(t,e)}catch(t){console.error("Errore durante l'invio della mappatura:",t),Fe(t.message||"Errore durante l'invio della mappatura")}},xe=t=>{const a=Object.entries(O()).find(([h,o])=>typeof o=="string"&&o.trim()===t);return a?a[0]:null},_e=P(()=>{console.log("Calculating transactionExamples (detailed)...");const t=O();if(!V.rows||V.rows.length===0)return console.log("DEBUG Memo: props.rows è vuoto."),[];const e={};Le.forEach($=>{e[$]=Object.entries(t).find(([L,U])=>typeof U=="string"&&U.trim()===$)?.[0]});const a=V.rows.slice(0,5),h="amount";console.log(`DEBUG Memo: Cerco il valore ID: "${h}" (Tipo: string)`);const o=Object.entries(t);console.log("DEBUG Memo: Controllo queste entries:",JSON.stringify(o)),o.forEach(([$,L])=>{const E=(typeof L==="string"?L.trim():L)===h;console.log(`-- DEBUG Memo Entry: Chiave="<span class="math-inline">{key}", Valore="</span>{value}" (Tipo: <span class="math-inline">{valueType}). Confronto diretto ('</span>{amountFieldId}'): <span class="math-inline">{directMatch}. Confronto con trim ('</span>{amountFieldId}'): ${E}`)});const S=e.amount;if(!S)return console.log("DEBUG Memo: Amount header non mappato, impossibile calcolare esempi completi."),[];if(console.log("DEBUG: Header mappato per 'amount' (Risultato finale find):",S),!S)return console.log("DEBUG Memo: Amount header NON trovato, ritorno array vuoto."),[];console.log(`DEBUG Memo: Amount header trovato: "${S}". Calcolo esempi...`);const J=a.map(($,L)=>{const U=e.walletId?$[e.walletId]??"N/D":"Non Mappato",Z=e.cause?$[e.cause]??"N/D":"Non Mappato",E=e.currency?$[e.currency]??"N/D":"Non Mappato",ae=e.date?$[e.date]??"N/D":"Non Mappato",ie=$[S],B=parseFloat(ie);let A="Non determinato";const f=g();if(f.mode==="auto")A=B<0===f.negativeIsExpense?"Uscita":"Entrata";else if(f.mode==="column"&&f.columnName&&f.positiveValue&&f.negativeValue){const N=$[f.columnName];N===f.positiveValue?A="Entrata":N===f.negativeValue&&(A="Uscita")}const re=E&&E!=="Non Mappato"&&E!=="N/D"?E:"EUR";return{walletId:U,cause:Z,amount:isNaN(B)?"N/A":new Intl.NumberFormat("it-IT",{style:"currency",currency:re}).format(B),currency:E,date:ae,interpretation:A}});return console.log(`DEBUG: Esempi dettagliati calcolati: ${J.length}`),J});return(()=>{var t=c(ht),e=t.firstChild,a=e.nextSibling,h=a.nextSibling,[o,S]=d(h.nextSibling),J=o.nextSibling,$=J.firstChild,L=$.firstChild,U=L.nextSibling,Z=U.nextSibling,E=$.nextSibling,ae=E.firstChild,ie=ae.nextSibling,B=ie.nextSibling,A=B.firstChild,[f,re]=d(A.nextSibling),N=f.nextSibling,He=N.firstChild,Ge=He.firstChild,Re=Ge.nextSibling,fe=J.nextSibling,qe=fe.firstChild,se=qe.nextSibling,he=se.firstChild,Pe=he.firstChild,We=Pe.nextSibling,ye=We.firstChild,Se=ye.firstChild,Je=ye.nextSibling,Ce=Je.firstChild,Qe=he.nextSibling,[Ee,Ke]=d(Qe.nextSibling),Xe=Ee.nextSibling,[Ye,Ze]=d(Xe.nextSibling),oe=fe.nextSibling,ee=oe.firstChild,et=ee.firstChild,[we,tt]=d(et.nextSibling);we.nextSibling;var nt=ee.nextSibling,[lt,at]=d(nt.nextSibling),Me=oe.nextSibling,De=Me.firstChild,it=De.nextSibling,[rt,st]=d(it.nextSibling);return n(t,p(D,{get when(){return ue()},get children(){var l=c(bt);return n(l,ue),l}}),o,S),n(Z,p(W,{get each(){return V.csvHeaders},children:l=>{const r=P(()=>Object.keys(O()).includes(l));return(()=>{var s=c(St),i=s.firstChild,m=i.firstChild,v=m.nextSibling,[x,C]=d(v.nextSibling);return R(s,"dragstart",Oe(l)),n(m,l),n(i,p(D,{get when(){return r()},get children(){var b=c(yt);return b.$$click=()=>ve(l),X(),b}}),x,C),y(b=>{var w=`p-3 rounded-md cursor-grab ${r()?"bg-gray-300 text-gray-600":"bg-blue-100 hover:bg-blue-200 text-blue-800"}`,T=!r();return w!==b.e&&te(s,b.e=w),T!==b.t&&ut(s,"draggable",b.t=T),b},{e:void 0,t:void 0}),s})()}})),n(B,p(W,{each:ce,children:l=>{const r=P(()=>xe(l.id)),s=de.includes(l.id);return(()=>{var i=c(Et),m=i.firstChild,v=m.firstChild,x=v.firstChild,C=x.nextSibling,[b,w]=d(C.nextSibling),T=v.nextSibling,[F,Q]=d(T.nextSibling);return R(i,"drop",$e(l.id)),i.addEventListener("dragleave",be),R(i,"dragover",me(l.id)),n(x,()=>l.label),n(v,s&&c(wt),b,w),n(m,p(D,{get when(){return r()},get children(){var H=c(Ct),j=H.firstChild,_=j.nextSibling;return n(j,r),_.$$click=()=>Be(l.id),X(),H}}),F,Q),y(()=>te(i,`p-3 rounded-md border-2 ${pe()===l.id?"border-blue-500 bg-blue-50":r()?"border-green-500 bg-green-50":s?"border-yellow-300 bg-yellow-50":"border-gray-300 bg-white"}`)),i})()}}),f,re),R(N,"drop",$e("non_utilizzare")),N.addEventListener("dragleave",be),R(N,"dragover",me("non_utilizzare")),n(Re,p(W,{get each(){return Object.entries(O())},children:([l,r])=>p(D,{when:r==="non_utilizzare",get children(){var s=c(Mt),i=s.firstChild,[m,v]=d(i.nextSibling),x=m.nextSibling;return n(s,l,m,v),x.$$click=()=>ve(l),X(),s}})})),Se.addEventListener("change",()=>z({mode:"auto"})),Ce.addEventListener("change",()=>z({mode:"column"})),n(se,p(D,{get when(){return g().mode==="auto"},get children(){var l=c($t),r=l.firstChild,s=r.nextSibling,i=s.firstChild,m=i.firstChild,v=s.nextSibling,x=v.firstChild,C=x.firstChild;return m.addEventListener("change",()=>z({negativeIsExpense:!0})),C.addEventListener("change",()=>z({negativeIsExpense:!1})),y(()=>I(m,"checked",g().negativeIsExpense===!0)),y(()=>I(C,"checked",g().negativeIsExpense===!1)),l}}),Ee,Ke),n(se,p(D,{get when(){return g().mode==="column"},get children(){var l=c(vt),r=l.firstChild,s=r.firstChild,i=s.nextSibling,m=i.firstChild,v=m.nextSibling,[x,C]=d(v.nextSibling),b=r.nextSibling,w=b.firstChild,T=w.firstChild,F=T.nextSibling,Q=w.nextSibling,H=Q.firstChild,j=H.nextSibling;return i.addEventListener("change",_=>z({columnName:_.currentTarget.value})),n(i,p(W,{get each(){return V.csvHeaders},children:_=>(()=>{var G=c(Dt);return I(G,"value",_),n(G,_),G})()}),x,C),F.addEventListener("change",_=>z({positiveValue:_.currentTarget.value})),j.addEventListener("change",_=>z({negativeValue:_.currentTarget.value})),y(()=>I(i,"value",g().columnName||"")),y(()=>I(F,"value",g().positiveValue||"")),y(()=>I(j,"value",g().negativeValue||"")),l}}),Ye,Ze),ee.$$click=()=>ge(!k()),n(ee,()=>k()?"▼ ":"► ",we,tt),n(oe,p(D,{get when(){return k()},get children(){var l=c(ft),r=l.firstChild,s=r.firstChild,[i,m]=d(s.nextSibling);i.nextSibling;var v=r.nextSibling,[x,C]=d(v.nextSibling),b=x.nextSibling,[w,T]=d(b.nextSibling);return r.$$click=()=>ge(!k()),n(r,()=>k()?"▼ ":"► ",i,m),n(l,p(D,{get when(){return P(()=>!!k())()&&_e().length>0},get children(){var F=c(xt),Q=F.firstChild,H=Q.nextSibling,j=H.firstChild,_=j.nextSibling,G=_.firstChild,ot=G.firstChild,[Ne,ct]=d(ot.nextSibling);Ne.nextSibling;var dt=_.nextSibling;return n(G,p(W,{each:ce,children:M=>(()=>{var K=c(Nt);return n(K,()=>M.label),K})()}),Ne,ct),n(dt,p(W,{get each(){return _e()},children:M=>(()=>{var K=c(Tt),Te=K.firstChild,Ie=Te.nextSibling,Ve=Ie.nextSibling,ke=Ve.nextSibling,ze=ke.nextSibling;return n(Te,()=>M.cause),n(Ie,()=>M.amount),n(Ve,()=>M.currency),n(ke,()=>M.date),n(ze,()=>M.interpretation),y(()=>te(ze,`p-2 font-medium ${M.interpretation==="Entrata"?"text-green-600":M.interpretation==="Uscita"?"text-red-600":"text-gray-600"}`)),K})()})),F}}),x,C),n(l,p(D,{get when(){return P(()=>!!k())()&&!xe("amount")},get children(){return c(_t)}}),w,T),X(),l}}),lt,at),R(De,"click",V.onCancel,!0),n(Me,p(gt,{onClick:Ae,text:"Conferma mappatura"}),rt,st),y(()=>te(N,`p-3 rounded-md border-2 ${pe()==="non_utilizzare"?"border-red-500 bg-red-50":"border-gray-300 bg-white"}`)),y(()=>I(Se,"checked",g().mode==="auto")),y(()=>I(Ce,"checked",g().mode==="column")),X(),t})()}pt(["click"]);export{Bt as default};
