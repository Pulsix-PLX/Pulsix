import{createComponent as s,ssr as i,ssrHydrationKey as c,ssrAttribute as w,escape as o}from"solid-js/web";import{createSignal as r,createMemo as _,onMount as O,onCleanup as T,Switch as N,Match as y,Show as P,For as R}from"solid-js";import{n as A}from"./index-CI1g57kZ.js";import{c as V}from"./server-fns-runtime-4T1EILgx.js";import{d as x}from"./db.server-BYnrqg0d.js";import*as U from"bcryptjs";import{a as k,u as E}from"./action-BVKOmiKt.js";import{initializeApp as F}from"firebase/app";import{getAnalytics as H,setAnalyticsCollectionEnabled as q}from"firebase/analytics";import{getAuth as M,RecaptchaVerifier as B,GoogleAuthProvider as K,signInWithPhoneNumber as z}from"firebase/auth";import{g as L,S as Y,I as G,b as j,a as D}from"./Inputs-CEYxPBfP.js";import{B as J}from"./ButtonSparkle-DNpTyev3.js";const W=V(async t=>{const{username:e,passwordConfirm:a,name:l,surname:f,dateOfBirthday:m,email:n,phone:b}=t;if(console.log("username: ",e),console.log("password: ",a),console.log("name: ",l),console.log("surname: ",f),console.log("dateOfBirthday: ",m),console.log("email: ",n),console.log("phone: ",b),!a)return console.error("Password is required"),{success:!1,error:"Password is required"};try{const u=String(a).trim();if(u.length<6)return{success:!1,error:"Password must be at least 6 characters long"};const S=await U.hash(u,10),v=(await x.query(`INSERT INTO users 
      (username, password, name, surname, date_of_birth, phone_number, email)
      VALUES ($1, $2, $3, $4, $5, $6, $7)
      RETURNING id, username`,[e,S,l,f,m,b,n])).rows[0];return{success:!0,userId:v.id,username:v.username}}catch(u){return console.error("Error during user insertion:",u),{success:!1,error:u.message||"An unexpected error occurred"}}},"src_routes_API_Auth_registration_createUser_ts--createUser_action","C:/Users/Matteo/Desktop/Pulsix/src/routes/API/Auth/registration/createUser.ts?tsr-directive-use-server="),X=k(W,"createUser"),Q={apiKey:"AIzaSyAoiPbMYiKNnK6y_HqsYMLpvs2JiXaxPhw",authDomain:"finance-tracker-pallassini.firebaseapp.com",projectId:"finance-tracker-pallassini",storageBucket:"finance-tracker-pallassini.firebasestorage.app",messagingSenderId:"106835699922",appId:"1:106835699922:web:8655c7560a7d526c64650b",measurementId:"G-EKY43CN6SB"},C=F(Q),I=M(C),Z=H(C);q(Z,!0);const ee=()=>{window.recaptchaVerifier||(window.recaptchaVerifier=new B(I,"recaptcha-container",{size:"invisible",callback:t=>{console.log("reCAPTCHA resolved:",t)},"expired-callback":()=>{console.log("reCAPTCHA expired, please reload.")}}),window.recaptchaVerifier.render())};new K;var re=["<div",">","</div>"],te=["<form",' class="','" style="','"><div class="flex flex-row items-center mt-50"><select',' class="Input Prefix mr-7 border border-gray-300 p-2"><option value="+39">+39 (Italy)</option><option value="+1">+1 (USA)</option><option value="+44">+44 (UK)</option></select><!--$-->',"<!--/--></div><!--$-->","<!--/--><!--$-->",'<!--/--><div id="recaptcha-container" class="ml-100 mt-250"></div></form>'];const[se,Se]=r(""),[p,d]=r(""),[oe,h]=r(""),g=()=>`${$()}${L("phone")}`,[$,_e]=r("+39"),[Oe,Te]=r(""),[ne,Ne]=r(null);function Re(){const[t,e]=r("wait");return _(()=>{A()==2&&Y("phone",!1)}),O(()=>{console.log("Component mounted. Initializing reCAPTCHA..."),ee()}),T(()=>{console.log("Component unmounted. Cleaning up reCAPTCHA..."),window.recaptchaVerifier&&(window.recaptchaVerifier.clear(),window.recaptchaVerifier=null)}),s(N,{get children(){return[s(y,{get when(){return t()=="wait"},get children(){return i(te,c(),"w-300 mt-100","justify-items:center",w("value",o($(),!0),!1),o(s(G,{type:"phoneNumber",name:"phone",placeholder:"Phone number",get mountOn(){return A()==1},required:!0})),o(s(P,{get when(){return oe()},get children(){return i(re,c(),o(p()))}})),o(s(J,{shadow:10,text:"Send code",get disabled(){return!j()},class:"h-50 mb-30",onClick:async()=>{await ie(),e("sended")}})))}}),s(y,{get when(){return t()=="sended"},get children(){return s(me,{get code(){return se()},get otp(){return ne()},createUser:!0})}})]}})}const[Ve,ae]=r();async function ie(){const t=g();D("phoneNumber",t),console.log("sendOTP called. phoneNumber:",g());try{const e=window.recaptchaVerifier;console.log("Sending OTP with appVerifier:",e);const a=await z(I,g(),e);ae(a)}catch(e){console.error("Error sending OTP:",e),e.message=="Firebase: Error (auth/too-many-requests)."?(d("Too-many-requests sended wait some minutes"),h(p())):e.message=="Firebase: TOO_SHORT (auth/invalid-phone-number)."?(d("Number lentgh is too short"),h(p())):e.message=="Firebase: Invalid format. (auth/invalid-phone-number)."?(d("Invalid format"),h(p())):e.message=="Firebase: Error (auth/invalid-app-credential)."&&(d("You are in local"),h(p()))}}var ce=["<p",' class="responseOTP">',"</p>"],le=["<div",' class="otp-container"><div class="otp-field">',"</div><!--$-->","<!--/--></div>"],ue=["<input",' type="number" pattern="[0-9]*" inputmode="numeric" maxlength="1"',">"],pe=["<span",' class="text-white text-3xl ml-10 mr-10">&#183;</span>'];function me(t){const[e,a]=r(Array(6).fill("")),[l,f]=r("");return E(X),i(le,c(),o(s(R,{get each(){return e()},children:(m,n)=>[i(ue,c(),w("value",o(m,!0),!1)+w("class",n()===0?"inputLeft":n()===5||n()===2?"inputRight":n()===3?"inputLeft":"",!1)),n()===2&&i(pe,c())]})),o(s(P,{get when(){return l()},get children(){return i(ce,c(),o(l()))}})))}export{me as O,Re as P,ie as a,I as b,d as c,h as d,X as e,g as f,p as m,ee as s};
