import{g as b,b as Q,i as g,j as R,r as A,t as v,u as X,d as ve,e as D,a as ye}from"./web-DpIebe6J.js";import{k as Y,f as c,n as fe,a as x,d as I,o as me,F as L,S as ee}from"./solid-DuWri35y.js";import{c as n,r as xe,a as we,u as $e,b as Ce,d as _e}from"./context-DTlNXViu.js";import{B as te}from"./ButtonSparkle-B8MvXRxa.js";import"./store-EkIb7068.js";var Se=v(`<div class="p-6 border rounded-lg shadow-lg mb-6 "><h2 class="text-2xl font-bold mb-3">Anteprima Dati (Contestualizzata)</h2><p class="text-sm text-gray-600 mb-4">Dataset con <!$><!/> righe totali - <span class="font-medium text-blue-600">Clicca su una cella per modificare</span>(Salvataggio automatico uscendo dalla cella)</p><div class="overflow-auto border border-gray-200 rounded-lg relative"><div><table class="w-full bg-white border-separate border-spacing-0"><thead class="sticky top-0 z-10 bg-gray-100"><tr></tr></thead><tbody></tbody></table></div></div><div class="mt-6 flex justify-end items-center"><div class="flex space-x-2"><button class=" bg-gray-200 text-gray-800 rounded hover:bg-gray-300"title="Annulla l'intero processo di importazione">Back to upload file</button><!$><!/></div></div><div class="my-4 flex justify-start space-x-2"><button class="px-3 py-1 text-sm bg-red-100 text-red-800 rounded hover:bg-red-200 disabled:opacity-50 disabled:cursor-not-allowed"title="Annulla tutte le modifiche fatte nella tabella">Resetta Modifiche Tabella</button><button class="px-3 py-1 text-sm bg-yellow-100 text-yellow-800 rounded hover:bg-yellow-200 disabled:opacity-50 disabled:cursor-not-allowed"title="Annulla l'ultima modifica fatta nella tabella">Annulla Ultima Modifica`),Pe=v('<th class="py-3 px-4 ...">'),ke=v('<tr class="hover:bg-gray-50 border-b border-gray-200">'),Ee=v('<input type=text class="w-full h-full px-4 py-3 ...">'),Te=v('<td class="py-3 px-4 border-gray-200">'),Ae=v('<div class="w-full h-full flex items-center cursor-pointer">'),Ie=v('<button class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Next to mapper');function Oe(){const[y,H]=Y(null),[le,re]=Y(0);let u;const O=c(()=>(n.history?.length||0)>0);fe(()=>{u&&u.addEventListener("scroll",B),document.addEventListener("mousedown",Z),console.log("Componente CsvPreview CONTESTUALIZZATO montato.")}),me(()=>{u&&u.removeEventListener("scroll",B),document.removeEventListener("mousedown",Z),console.log("Componente CsvPreview CONTESTUALIZZATO smontato.")});const S=48,N=800,z=c(()=>typeof window<"u"?Math.min(N,window.innerHeight*.8):N),ae=c(()=>Math.ceil(z()/S)+5),P=c(()=>Math.max(0,Math.floor(le()/S))),oe=c(()=>{const e=Array.isArray(n.data?.rows)?n.data?.rows:[];if(!e)return[];const t=P(),a=ae(),s=Math.min(t+a,e.length);return e.slice(t,s)}),ne=c(()=>(n.data?.rows?.length??0)*S),k=()=>{y()!==null&&H(null)},B=e=>{re(e.target.scrollTop)},Z=e=>{y()&&u&&!u.contains(e.target)&&k()},se=(e,t)=>{const a=y();a?.visibleRowIndex===e&&a?.header===t||H({visibleRowIndex:e,header:t})},j=(e,t,a)=>{const s=P()+e,f=n.data?.rows;if(!f||s<0||s>=f.length){console.error("saveDataToContext: Indice riga non valido o dati non pronti:",s);return}const E=f[s]?.[t];if(String(E??"")===String(a??""))return;const w=[...f],i={...w[s]};i[t]=a,w[s]=i,_e(w)},ie=e=>{const t=y();t&&j(t.visibleRowIndex,t.header,e.target.value)},de=e=>{const t=y();t&&(e.key==="Enter"?(e.preventDefault(),j(t.visibleRowIndex,t.header,e.target.value),k()):e.key==="Escape"&&k())};function U(){k(),(n.data?.headers??[]).length>0?(console.log(n.data),Ce("mapping")):console.warn("Impossibile procedere: dati/headers mancanti nel context.")}return(()=>{var e=b(Se),t=e.firstChild,a=t.nextSibling,s=a.firstChild,f=s.nextSibling,[E,w]=Q(f.nextSibling);E.nextSibling;var i=a.nextSibling,T=i.firstChild,$=T.firstChild,F=$.firstChild,ce=F.firstChild,ue=F.nextSibling,V=i.nextSibling,K=V.firstChild,W=K.firstChild,pe=W.nextSibling,[ge,he]=Q(pe.nextSibling),be=V.nextSibling,M=be.firstChild,q=M.nextSibling;g(a,()=>n.data?.rows?.length||0,E,w);var G=u;return typeof G=="function"?X(G,i):u=i,i.style.setProperty("width","70%"),T.style.setProperty("position","relative"),$.style.setProperty("position","absolute"),$.style.setProperty("width","100%"),g(ce,x(L,{get each(){return n.data?.headers},children:l=>(()=>{var d=b(Pe);return g(d,l),d})()})),g(ue,x(L,{get each(){return oe()},children:(l,d)=>(()=>{var h=b(ke);return h.style.setProperty("height","48px"),g(h,x(L,{get each(){return n.data?.headers},children:p=>{const C=c(()=>P()+d()),_=c(()=>{const o=y();return o!==null&&o.visibleRowIndex===d()&&o.header===p}),J=c(()=>{const o=n.data?.rows,r=C();return o?.[r]?.[p]??""});return(()=>{var o=b(Te);return o.style.setProperty("position","relative"),g(o,x(ee,{get when(){return _()},get fallback(){return(()=>{var r=b(Ae);return r.$$click=()=>se(d(),p),g(r,J),I(()=>ye(r,"title",`Riga ${C()}, Colonna ${p}`)),A(),r})()},get children(){var r=b(Ee);return r.$$mousedown=m=>m.stopPropagation(),r.$$click=m=>m.stopPropagation(),X(m=>setTimeout(()=>m.focus(),0),r),r.$$keydown=de,r.addEventListener("blur",ie),I(()=>D(r,"value",J())),A(),r}})),I(r=>(r=_()?"0":void 0)!=null?o.style.setProperty("padding",r):o.style.removeProperty("padding")),o})()}})),h})()})),R(W,"click",xe,!0),g(K,x(ee,{when:typeof te<"u",get fallback(){return(()=>{var l=b(Ie);return l.$$click=U,A(),l})()},get children(){return x(te,{onClick:U,text:"Procedi con la mappatura"})}}),ge,he),R(M,"click",we,!0),R(q,"click",$e,!0),I(l=>{var d=`${z()}px`,h=`${ne()}px`,p=`${P()*S}px`,C=!O(),_=!O();return d!==l.e&&((l.e=d)!=null?i.style.setProperty("height",d):i.style.removeProperty("height")),h!==l.t&&((l.t=h)!=null?T.style.setProperty("height",h):T.style.removeProperty("height")),p!==l.a&&((l.a=p)!=null?$.style.setProperty("top",p):$.style.removeProperty("top")),C!==l.o&&D(M,"disabled",l.o=C),_!==l.i&&D(q,"disabled",l.i=_),l},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),A(),e})()}ve(["click","keydown","mousedown"]);export{Oe as default};
