import{ssr as n,ssrHydrationKey as o,escape as e,createComponent as a,ssrAttribute as m}from"solid-js/web";import{createSignal as f,Show as i,createMemo as g,onMount as Z,onCleanup as K,For as y}from"solid-js";import{c as s,s as O,a as B,i as Q}from"./assets/context-5bbmmXgY.js";import{a as X}from"./assets/auth-B-0Ucn5g.js";import{B as V}from"./assets/ButtonSparkle-BxHzGCPC.js";import{M as Y}from"./assets/index-B8s1itkY.js";import{a as ee}from"./assets/Inputs-D1T1pLkj.js";import{P as te}from"./assets/pathWallets-Cb2AeUiP.js";import{s as ae}from"./assets/Menu-CWXr7U88.js";import{p as oe}from"./assets/index-ClXKiMUD.js";import"solid-js/store";import"axios";/* empty css                     */import"gsap";import"./assets/server-fns-runtime-C3tiYEg6.js";import"solid-js/web/storage";import"./assets/fetchEvent-9EzSf9d7.js";import"h3";import"vite-plugin-node-polyfills/shims/global";import"node:async_hooks";import"./assets/db.server-CDeyn5Z_.js";import"vite-plugin-node-polyfills/shims/process";import"pg";import"./assets/action-BR9kmesq.js";import"./assets/routing-BRXp7sqN.js";import"./assets/getWallets.server-C5R6kBVO.js";import"./assets/auth.server-ChqlnWrh.js";import"./assets/components-DHKGOKg1.js";var ne=["<p",' style="','">Selected file: <strong>',"</strong></p>"],re=["<p",' style="','">',"</p>"],se=["<div",' class="CM"><h1>Carica Estratto Conto (CSV)</h1><form enctype="multipart/form-data" class><!--$-->',"<!--/--><!--$-->","<!--/--><!--$-->","<!--/--><!--$-->","<!--/--><!--$-->","<!--/--></form></div>"],ie=["<strong",">CSV file</strong>"],le=["<br",">"];function de(){const[c,$]=f(null);function E(N){const D=N.currentTarget.files?.[0];D?D.name.toLowerCase().endsWith(".csv")?($(D),O(null)):($(null),O("File selected is not a csv file")):($(null),O(null))}return n(se,o(),e(a(Y,{id:"csv-file-input",name:"csv",accept:".csv",required:!0,onChange:E,get label(){return["Drag & drop your ",n(ie,o())," here,",n(le,o())," or click to select"]},draggingLabel:"Release to drop the CSV file!"})),e(a(i,{get when(){return c()},get children(){return n(ne,o(),"margin-top:1rem;color:#e2e8f0",e(c()?.name))}})),e(a(i,{get when(){return s.errorMessage},get children(){return n(re,o(),"color:red;margin-top:10px",e(s.errorMessage))}})),e(a(te,{})),e(a(V,{type:"submit",get disabled(){return!c()||!ee()},text:"Submit file",class:"ml-130 mt-100"})))}var ce=["<div",' class="p-6 border rounded-lg shadow-lg mb-6 "><h2 class="text-2xl font-bold mb-3">Anteprima Dati (Contestualizzata)</h2><p class="text-sm text-gray-600 mb-4">Dataset con <!--$-->','<!--/--> righe totali - <span class="font-medium text-blue-600">Clicca su una cella per modificare</span>(Salvataggio automatico uscendo dalla cella)</p><div class="overflow-auto border border-gray-200 rounded-lg relative" style="','"><div style="','"><table class="w-full bg-white border-separate border-spacing-0" style="','"><thead class="sticky top-0 z-10 bg-gray-100"><tr>',"</tr></thead><tbody>",`</tbody></table></div></div><div class="mt-6 flex justify-end items-center"><div class="flex space-x-2"><button class=" bg-gray-200 text-gray-800 rounded hover:bg-gray-300" title="Annulla l'intero processo di importazione">Back to upload file</button><!--$-->`,'<!--/--></div></div><div class="my-4 flex justify-start space-x-2"><button class="px-3 py-1 text-sm bg-red-100 text-red-800 rounded hover:bg-red-200 disabled:opacity-50 disabled:cursor-not-allowed"',' title="Annulla tutte le modifiche fatte nella tabella">Resetta Modifiche Tabella</button><button class="px-3 py-1 text-sm bg-yellow-100 text-yellow-800 rounded hover:bg-yellow-200 disabled:opacity-50 disabled:cursor-not-allowed"',` title="Annulla l'ultima modifica fatta nella tabella">Annulla Ultima Modifica</button></div></div>`],pe=["<th",' class="','">',"</th>"],ue=["<tr",' class="hover:bg-gray-50 border-b border-gray-200" style="','">',"</tr>"],me=["<input",' type="text" class="w-full h-full px-4 py-3 ..."',">"],ge=["<td",' class="','" style="','">',"</td>"],be=["<div",' class="w-full h-full flex items-center cursor-pointer" title="','">',"</div>"],ve=["<button",' class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Next to mapper</button>'];function he(){const[c,$]=f(null),[E,N]=f(0);let I;const D=g(()=>(s.history?.length||0)>0);Z(()=>{document.addEventListener("mousedown",T),console.log("Componente CsvPreview CONTESTUALIZZATO montato.")}),K(()=>{document.removeEventListener("mousedown",T),console.log("Componente CsvPreview CONTESTUALIZZATO smontato.")});const x=48,S=800,p="70%",U="py-3 px-4",M=g(()=>typeof window<"u"?Math.min(S,window.innerHeight*.8):S),k=g(()=>Math.ceil(M()/x)+5),C=g(()=>Math.max(0,Math.floor(E()/x))),j=g(()=>{const t=Array.isArray(s.data?.rows)?s.data?.rows:[];if(!t)return[];const r=C(),l=k(),b=Math.min(r+l,t.length);return t.slice(r,b)}),z=g(()=>(s.data?.rows?.length??0)*x),F=()=>{c()!==null&&$(null)},T=t=>{c()};function H(){F(),(s.data?.headers??[]).length>0?(console.log(s.data),B("mapping")):console.warn("Impossibile procedere: dati/headers mancanti nel context.")}return n(ce,o(),e(s.data?.rows?.length)||0,`height:${e(M(),!0)}px`+(";width:"+e(p,!0)),`height:${e(z(),!0)}px;position:relative`,`position:absolute;top:${e(C(),!0)*e(x,!0)}px;width:100%`,e(a(y,{get each(){return s.data?.headers},children:t=>n(pe,o(),`${e(U,!0)} ...`,e(t))})),e(a(y,{get each(){return j()},children:(t,r)=>n(ue,o(),`height:${e(x,!0)}px`,e(a(y,{get each(){return s.data?.headers},children:l=>{const b=g(()=>C()+r()),u=g(()=>{const w=c();return w!==null&&w.visibleRowIndex===r()&&w.header===l}),d=g(()=>{const w=s.data?.rows,v=b();return w?.[v]?.[l]??""});return n(ge,o(),`${e(U,!0)} border-gray-200`,"padding:"+(u()?"0":e(void 0,!0))+";position:relative",e(a(i,{get when(){return u()},get fallback(){return n(be,o(),`Riga ${e(b(),!0)}, Colonna ${e(l,!0)}`,e(d()))},get children(){return n(me,o(),m("value",e(d(),!0),!1))}})))}})))})),e(a(i,{when:typeof V<"u",get fallback(){return n(ve,o())},get children(){return a(V,{onClick:H,text:"Procedi con la mappatura"})}})),m("disabled",!D(),!0),m("disabled",!D(),!0))}var fe=["<div",' class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">',"</div>"],ye=["<div",'><p class="font-medium mb-2">Interpretazione del segno:</p><div class="flex items-center space-x-4"><label class="flex items-center"><input type="radio" name="signInterpretation" value="negativeIsExpense"','><span class="ml-2">Importi negativi = Uscite, Importi positivi = Entrate</span></label></div><div class="flex items-center space-x-4 mt-2"><label class="flex items-center"><input type="radio" name="signInterpretation" value="negativeIsIncome"','><span class="ml-2">Importi negativi = Entrate, Importi positivi = Uscite</span></label></div></div>'],xe=["<div",' class="space-y-3"><div><label class="block font-medium mb-1">Colonna che indica il tipo:</label><select class="w-full p-2 border rounded"',"><option value>-- Seleziona colonna --</option><!--$-->",'<!--/--></select></div><div class="grid grid-cols-2 gap-4"><div><label class="block font-medium mb-1">Valore per Entrate:</label><input type="text" class="w-full p-2 border rounded"',' placeholder="es. entrata, income, guadagno"></div><div><label class="block font-medium mb-1">Valore per Uscite:</label><input type="text" class="w-full p-2 border rounded"',' placeholder="es. uscita, expense, spesa"></div></div></div>'],Ce=["<div",` class="mt-2 p-4 bg-gray-50 rounded-lg overflow-x-auto"><p class="text-xs text-gray-600 mb-2">Questa è un'anteprima di come verranno interpretati i dati in base alla mappatura e alla logica del tipo transazione attuale. 'N/D' significa che il valore nella riga originale era vuoto o nullo. 'Non Mappato' significa che il campo sistema non è stato associato a nessuna colonna CSV.</p><table class="w-full min-w-max text-sm"> <thead><tr class="border-b-2 border-gray-300 text-left"><!--$-->`,'<!--/--><th class="p-2 font-semibold">Interpretazione</th> </tr></thead><tbody>',"</tbody></table></div>"],we=["<p",` class="mt-2 text-sm text-orange-600">Per vedere l'anteprima dell'interpretazione, mappa prima il campo "Amount".</p>`],$e=["<div",' class="mt-4"><!--$-->',"<!--/--><!--$-->","<!--/--></div>"],De=["<div",' class="p-6 border rounded-lg shadow-lg mb-6 bg-white"><h2 class="text-2xl font-bold mb-3">Mappatura Colonne</h2><p class="text-sm text-gray-600 mb-4">Trascina le colonne del CSV nei campi del sistema corrispondenti</p><!--$-->','<!--/--><div class="flex gap-6"><div class="w-1/2 bg-gray-50 p-4 rounded-lg"><h3 class="text-lg font-semibold mb-3">Colonne CSV</h3><p class="text-sm text-gray-500 mb-3">Trascina queste colonne nei campi a destra</p><div class="space-y-2">','</div></div><div class="w-1/2 bg-gray-50 p-4 rounded-lg"><h3 class="text-lg font-semibold mb-3">Campi Sistema</h3><p class="text-sm text-gray-500 mb-3">Rilascia le colonne CSV qui</p><div class="space-y-2"><!--$-->','<!--/--><div class="','"><div class="flex justify-between items-center"><span class="font-medium text-gray-500">Non utilizzare</span><div class="flex flex-wrap gap-1 max-w-xs">',`</div></div></div></div></div></div><div class="mt-6 p-4 bg-gray-50 rounded-lg"><h3 class="text-lg font-semibold mb-3">Configurazione Tipo Transazione</h3><div class="space-y-4"><div><p class="font-medium mb-2">Come determinare se una transazione è un'entrata o un'uscita?</p><div class="flex items-center space-x-4"><label class="flex items-center"><input type="radio" name="transactionType" value="auto"`,`><span class="ml-2">Dal segno dell'importo</span></label><label class="flex items-center"><input type="radio" name="transactionType" value="column"`,'><span class="ml-2">Da una colonna specifica</span></label></div></div><!--$-->',"<!--/--><!--$-->",'<!--/--></div></div><div class="mt-4"><button class="text-blue-600 hover:text-blue-800 text-sm flex items-center"><!--$-->',"<!--/-->Mostra anteprima interpretazione transazioni</button><!--$-->",'<!--/--></div><div class="mt-6 flex justify-between"><button class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">Go back</button><!--$-->','<!--/--></div><div class="mt-4 text-sm text-gray-500"><p>* I campi contrassegnati sono obbligatori</p></div></div>'],Se=["<button",' class="text-gray-600 hover:text-red-600" title="Rimuovi mappatura">✕</button>'],Ae=["<div",' class="','"','><div class="flex justify-between items-center"><span>',"</span><!--$-->","<!--/--></div></div>"],Ee=["<div",' class="flex items-center"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2">','</span><button class="text-gray-500 hover:text-red-600" title="Rimuovi mappatura">✕</button></div>'],Ie=["<div",' class="','"><div class="flex justify-between items-center"><div><span class="font-medium">',"</span><!--$-->","<!--/--></div><!--$-->","<!--/--></div></div>"],q=["<span",' class="text-red-500 ml-1">*</span>'],Me=["<span",' class="bg-gray-200 text-gray-700 px-2 py-1 rounded text-xs flex items-center"><!--$-->','<!--/--><button class="ml-1 text-gray-500 hover:text-red-600">✕</button></span>'],Te=["<option",">","</option>"],_e=["<th",' class="p-2 font-semibold">',"</th>"],ze=["<tr",' class="border-b border-gray-200"><td class="p-2">','</td><td class="p-2">','</td><td class="p-2">','</td><td class="','">',"</td></tr>"];function Re(){const[c,$]=f({}),[E,N]=f(null),[I,D]=f(null),[x,S]=f(null),[p,U]=f({mode:"auto",negativeIsExpense:!0}),M=[{id:"amount",label:"Amount"},{id:"cause",label:"Cause"},{id:"date",label:"Date"},{id:"category_id",label:"category"},{id:"subCategory_id",label:"Sub Category"}],k=["amount"],[C,j]=f(!1),z=t=>{const l=Object.entries(c()).find(([b,u])=>typeof u=="string"&&u.trim()===t);return l?l[0]:null},F=["cause","amount","date"],T=g(()=>{console.log("Calculating transactionExamples (detailed)...");const t=c();if(!s.data?.rows||s.data?.length===0)return console.log("DEBUG Memo: props.rows è vuoto."),[];const r={};F.forEach(v=>{r[v]=Object.entries(t).find(([A,_])=>typeof _=="string"&&_.trim()===v)?.[0]});const l=s.data?.rows.slice(0,5),b="amount";console.log(`DEBUG Memo: Cerco il valore ID: "${b}" (Tipo: string)`);const u=Object.entries(t);console.log("DEBUG Memo: Controllo queste entries:",JSON.stringify(u)),u.forEach(([v,A])=>{const P=(typeof A==="string"?A.trim():A)===b;console.log(`-- DEBUG Memo Entry: Chiave="<span class="math-inline">{key}", Valore="</span>{value}" (Tipo: <span class="math-inline">{valueType}). Confronto diretto ('</span>{amountFieldId}'): <span class="math-inline">{directMatch}. Confronto con trim ('</span>{amountFieldId}'): ${P}`)});const d=r.amount;if(!d)return console.log("DEBUG Memo: Amount header non mappato, impossibile calcolare esempi completi."),[];if(console.log("DEBUG: Header mappato per 'amount' (Risultato finale find):",d),!d)return console.log("DEBUG Memo: Amount header NON trovato, ritorno array vuoto."),[];console.log(`DEBUG Memo: Amount header trovato: "${d}". Calcolo esempi...`);const w=l.map((v,A)=>{const _=r.walletId?v[r.walletId]??"N/D":"Non Mappato",G=r.cause?v[r.cause]??"N/D":"Non Mappato",P=r.date?v[r.date]??"N/D":"Non Mappato",J=v[d],L=parseFloat(J);let R="Non determinato";const h=p();if(h.mode==="auto")R=L<0===h.negativeIsExpense?"Expense":"Income";else if(h.mode==="column"&&h.columnName&&h.positiveValue&&h.negativeValue){const W=v[h.columnName];W===h.positiveValue?R="Income":W===h.negativeValue&&(R="Expense")}return{walletId:_,cause:G,amount:isNaN(L)?"N/A":L,date:P,interpretation:R}});return console.log(`DEBUG: Esempi dettagliati calcolati: ${w.length}`),w}),H=async()=>{console.log("Processing data before sending..."),S(null);const t=s.data?.rows,r=c(),l=p();if(!t||t.length===0){S("Nessun dato da processare.");return}const b=oe(t,r,l);console.log("Dati processati pronti per l'invio:",b);const u=b.filter(d=>d.amount!==null&&d.type!==null);if(u.length===0){S("Nessuna transazione valida trovata dopo il processamento. Controlla la mappatura e i dati.");return}try{await X.api.post("API/Wallets/Wallet/addTransactionByFile/addTransactions",{transactions:u,walletId:s.walletId}),console.log(`Inviate ${u.length} transazioni processate al server.`),B("complete")}catch(d){console.error("Errore durante l'invio dei dati processati:",d),S(d.response?.data?.message||d.message||"Errore durante l'invio dei dati al server")}};return n(De,o(),e(a(i,{get when(){return x()},get children(){return n(fe,o(),e(x()))}})),e(a(y,{get each(){return s.data?.headers},children:t=>{const r=g(()=>Object.keys(c()).includes(t));return n(Ae,o(),`p-3 rounded-md cursor-grab ${r()?"bg-gray-300 text-gray-600":"bg-blue-100 hover:bg-blue-200 text-blue-800"}`,m("draggable",!r(),!1),e(t),e(a(i,{get when(){return r()},get children(){return n(Se,o())}})))}})),e(a(y,{each:M,children:t=>{const r=g(()=>z(t.id)),l=k.includes(t.id);return n(Ie,o(),`p-3 rounded-md border-2 ${I()===t.id?"border-blue-500 bg-blue-50":r()?"border-green-500 bg-green-50":l?"border-yellow-300 bg-yellow-50":"border-gray-300 bg-white"}`,e(t.label),l&&q[0]+o()+q[1],e(a(i,{get when(){return r()},get children(){return n(Ee,o(),e(r()))}})))}})),`p-3 rounded-md border-2 ${I()==="non_utilizzare"?"border-red-500 bg-red-50":"border-gray-300 bg-white"}`,e(a(y,{get each(){return Object.entries(c())},children:([t,r])=>a(i,{when:r==="non_utilizzare",get children(){return n(Me,o(),e(t))}})})),m("checked",p().mode==="auto",!0),m("checked",p().mode==="column",!0),e(a(i,{get when(){return p().mode==="auto"},get children(){return n(ye,o(),m("checked",p().negativeIsExpense===!0,!0),m("checked",p().negativeIsExpense===!1,!0))}})),e(a(i,{get when(){return p().mode==="column"},get children(){return n(xe,o(),m("value",e(p().columnName,!0)||"",!1),e(a(y,{get each(){return s.data?.headers},children:t=>n(Te,o()+m("value",e(t,!0),!1),e(t))})),m("value",e(p().positiveValue,!0)||"",!1),m("value",e(p().negativeValue,!0)||"",!1))}})),C()?"▼ ":"► ",e(a(i,{get when(){return C()},get children(){return n($e,o(),e(a(i,{get when(){return C()&&T().length>0},get children(){return n(Ce,o(),e(a(y,{each:M,children:t=>n(_e,o(),e(t.label))})),e(a(y,{get each(){return T()},children:t=>n(ze,o(),e(t.amount),e(t.cause),e(t.date),`p-2 font-medium ${t.interpretation==="Income"?"text-green-600":t.interpretation==="Expense"?"text-red-600":"text-gray-600"}`,e(t.interpretation))})))}})),e(a(i,{get when(){return C()&&!z("amount")},get children(){return n(we,o())}})))}})),e(a(V,{onClick:H,text:"Conferma mappatura"})))}var Ve=["<div"," class>","</div>"];function dt(){return Z(()=>ae(!1)),Q({headers:["Date","Description","Amount","Category","Status"],rows:[{Date:"2025-04-21",Description:"Stipendio Aprile",Amount:2500.5,Category:"Income",Status:"Completed"},{Date:"2025-04-20",Description:"Supermercato Esselunga",Amount:-75.3,Category:"Groceries",Status:"Completed"},{Date:"2025-04-19",Description:"Bolletta Luce",Amount:-55,Category:"Utilities",Status:"Completed"},{Date:"2025-04-18",Description:"Ristorante 'La Brace'",Amount:-42,Category:"Dining Out",Status:"Completed"},{Date:"2025-04-17",Description:"Amazon ordine #123",Amount:-120.99,Category:"Shopping",Status:"Pending"},{Date:"2025-04-16",Description:"Cinema Odeon",Amount:-18,Category:"Entertainment",Status:"Completed"},{Date:"2025-04-15",Description:"Rimborso Tasse",Amount:350,Category:"Income",Status:"Completed"},{Date:"2025-04-14",Description:"Palestra Mensile",Amount:-40,Category:"Health & Fitness",Status:"Completed"},{Date:"2025-04-13",Description:"Libri Universitari",Amount:-85.5,Category:"Education",Status:"Completed"},{Date:"2025-04-12",Description:"Riparazione Auto",Amount:-300,Category:"Transport",Status:"Completed"},{Date:"2025-04-15",Description:"Rimborso Tasse",Amount:350,Category:"Income",Status:"Completed"},{Date:"2025-04-14",Description:"Palestra Mensile",Amount:-40,Category:"Health & Fitness",Status:"Completed"},{Date:"2025-04-13",Description:"Libri Universitari",Amount:-85.5,Category:"Education",Status:"Completed"},{Date:"2025-04-12",Description:"Riparazione Auto",Amount:-300,Category:"Transport",Status:"Completed"},{Date:"2025-04-15",Description:"Rimborso Tasse",Amount:350,Category:"Income",Status:"Completed"},{Date:"2025-04-14",Description:"Palestra Mensile",Amount:-40,Category:"Health & Fitness",Status:"Completed"},{Date:"2025-04-13",Description:"Libri Universitari",Amount:-85.5,Category:"Education",Status:"Completed"},{Date:"2025-04-12",Description:"Riparazione Auto",Amount:-300,Category:"Transport",Status:"Completed"},{Date:"2025-04-15",Description:"Rimborso Tasse",Amount:350,Category:"Income",Status:"Completed"},{Date:"2025-04-14",Description:"Palestra Mensile",Amount:-40,Category:"Health & Fitness",Status:"Completed"},{Date:"2025-04-13",Description:"Libri Universitari",Amount:-85.5,Category:"Education",Status:"Completed"},{Date:"2025-04-12",Description:"Riparazione Auto",Amount:-300,Category:"Transport",Status:"Completed"}]},123),B("mapping"),[a(i,{get when(){return s.step==="upload"},get children(){return a(de,{})}}),a(i,{get when(){return s.step==="preview"},get children(){return n(Ve,o(),e(a(he,{})))}}),a(i,{get when(){return s.step==="mapping"},get children(){return a(Re,{})}})]}export{dt as default};
