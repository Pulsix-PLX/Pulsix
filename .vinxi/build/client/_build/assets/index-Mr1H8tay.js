import{g as c,b as u,i as n,j as K,r as ne,t as g,d as st,c as ae,a as ot,e as M}from"./web-DpIebe6J.js";import{k as O,f as X,a as p,d as C,S as w,F as U}from"./solid-DuWri35y.js";import{a as dt}from"./auth-MpTwZCDD.js";import{b as Ne,c as F}from"./context-DTlNXViu.js";import{B as ct}from"./ButtonSparkle-B8MvXRxa.js";import{p as pt}from"./index-ClXKiMUD.js";import"./store-EkIb7068.js";import"./index-Ckjqp3wL.js";import"./index-BbP3371Q.js";import"./index-BAMY2Nnw.js";import"./index-CgqXENQe.js";var gt=g('<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">'),mt=g('<div><p class="font-medium mb-2">Interpretazione del segno:</p><div class="flex items-center space-x-4"><label class="flex items-center"><input type=radio name=signInterpretation value=negativeIsExpense><span class=ml-2>Importi negativi = Uscite, Importi positivi = Entrate</span></label></div><div class="flex items-center space-x-4 mt-2"><label class="flex items-center"><input type=radio name=signInterpretation value=negativeIsIncome><span class=ml-2>Importi negativi = Entrate, Importi positivi = Uscite'),ut=g('<div class=space-y-3><div><label class="block font-medium mb-1">Colonna che indica il tipo:</label><select class="w-full p-2 border rounded"><option value>-- Seleziona colonna --</option><!$><!/></select></div><div class="grid grid-cols-2 gap-4"><div><label class="block font-medium mb-1">Valore per Entrate:</label><input type=text class="w-full p-2 border rounded"placeholder="es. entrata, income, guadagno"></div><div><label class="block font-medium mb-1">Valore per Uscite:</label><input type=text class="w-full p-2 border rounded"placeholder="es. uscita, expense, spesa">'),bt=g(`<div class="mt-2 p-4 bg-gray-50 rounded-lg overflow-x-auto"><p class="text-xs text-gray-600 mb-2">Questa è un'anteprima di come verranno interpretati i dati in base alla mappatura e alla logica del tipo transazione attuale. 'N/D' significa che il valore nella riga originale era vuoto o nullo. 'Non Mappato' significa che il campo sistema non è stato associato a nessuna colonna CSV.</p><table class="w-full min-w-max text-sm"> <thead><tr class="border-b-2 border-gray-300 text-left"><!$><!/><th class="p-2 font-semibold">Interpretazione</th> </tr></thead><tbody>`),$t=g(`<p class="mt-2 text-sm text-orange-600">Per vedere l'anteprima dell'interpretazione, mappa prima il campo "Amount".`),vt=g("<div class=mt-4><!$><!/><!$><!/>"),xt=g(`<div class="p-6 border rounded-lg shadow-lg mb-6 bg-white"><h2 class="text-2xl font-bold mb-3">Mappatura Colonne</h2><p class="text-sm text-gray-600 mb-4">Trascina le colonne del CSV nei campi del sistema corrispondenti</p><!$><!/><div class="flex gap-6"><div class="w-1/2 bg-gray-50 p-4 rounded-lg"><h3 class="text-lg font-semibold mb-3">Colonne CSV</h3><p class="text-sm text-gray-500 mb-3">Trascina queste colonne nei campi a destra</p><div class=space-y-2></div></div><div class="w-1/2 bg-gray-50 p-4 rounded-lg"><h3 class="text-lg font-semibold mb-3">Campi Sistema</h3><p class="text-sm text-gray-500 mb-3">Rilascia le colonne CSV qui</p><div class=space-y-2><!$><!/><div><div class="flex justify-between items-center"><span class="font-medium text-gray-500">Non utilizzare</span><div class="flex flex-wrap gap-1 max-w-xs"></div></div></div></div></div></div><div class="mt-6 p-4 bg-gray-50 rounded-lg"><h3 class="text-lg font-semibold mb-3">Configurazione Tipo Transazione</h3><div class=space-y-4><div><p class="font-medium mb-2">Come determinare se una transazione è un'entrata o un'uscita?</p><div class="flex items-center space-x-4"><label class="flex items-center"><input type=radio name=transactionType value=auto><span class=ml-2>Dal segno dell'importo</span></label><label class="flex items-center"><input type=radio name=transactionType value=column><span class=ml-2>Da una colonna specifica</span></label></div></div><!$><!/><!$><!/></div></div><div class=mt-4><button class="text-blue-600 hover:text-blue-800 text-sm flex items-center"><!$><!/>Mostra anteprima interpretazione transazioni</button><!$><!/></div><div class="mt-6 flex justify-between"><button class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">Go back</button><!$><!/></div><div class="mt-4 text-sm text-gray-500"><p>* I campi contrassegnati sono obbligatori`),_t=g('<button class="text-gray-600 hover:text-red-600"title="Rimuovi mappatura">✕'),ft=g('<div><div class="flex justify-between items-center"><span></span><!$><!/>'),ht=g('<div class="flex items-center"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2"></span><button class="text-gray-500 hover:text-red-600"title="Rimuovi mappatura">✕'),yt=g('<div><div class="flex justify-between items-center"><div><span class=font-medium></span><!$><!/></div><!$><!/>'),St=g('<span class="text-red-500 ml-1">*'),Ct=g('<span class="bg-gray-200 text-gray-700 px-2 py-1 rounded text-xs flex items-center"><!$><!/><button class="ml-1 text-gray-500 hover:text-red-600">✕'),Et=g("<option>"),wt=g('<th class="p-2 font-semibold">'),Dt=g('<tr class="border-b border-gray-200"><td class=p-2></td><td class=p-2></td><td class=p-2></td><td>');function Ot(){const[G,le]=O({}),[ze,ie]=O(null),[de,Y]=O(null),[ce,Z]=O(null),[h,ke]=O({mode:"auto",negativeIsExpense:!0}),pe=[{id:"amount",label:"Amount"},{id:"cause",label:"Cause"},{id:"date",label:"Date"},{id:"category_id",label:"category"},{id:"subCategory_id",label:"Sub Category"}],Ve=["amount"],[A,Le]=O(!1),Fe=a=>e=>{if(ie(a),e.dataTransfer){e.dataTransfer.effectAllowed="move";try{e.dataTransfer.setData("text/plain",a)}catch(l){console.error("Error setting drag data:",l)}}},ge=a=>e=>{e.preventDefault(),Y(a),e.dataTransfer&&(e.dataTransfer.dropEffect="move")},me=()=>{Y(null)},ue=a=>e=>{e.preventDefault();const l=ze();l&&le(b=>{const i={...b};return i[l]&&i[l]===a?(Y(null),ie(null),b):(Object.keys(i).forEach(o=>{i[o]===a&&delete i[o]}),i[l]=a,i)}),Y(null),ie(null)},je=a=>{le(e=>{const l={...e};return Object.keys(l).forEach(b=>{l[b]===a&&delete l[b]}),l})},be=a=>{le(e=>{const l={...e};return delete l[a],l})},N=a=>{ke(e=>({...e,...a}))},$e=a=>{const l=Object.entries(G()).find(([b,i])=>typeof i=="string"&&i.trim()===a);return l?l[0]:null},Be=["cause","amount","date"],ve=X(()=>{console.log("Calculating transactionExamples (detailed)...");const a=G();if(!F.data?.rows||F.data?.length===0)return console.log("DEBUG Memo: props.rows è vuoto."),[];const e={};Be.forEach(x=>{e[x]=Object.entries(a).find(([z,k])=>typeof k=="string"&&k.trim()===x)?.[0]});const l=F.data?.rows.slice(0,5),b="amount";console.log(`DEBUG Memo: Cerco il valore ID: "${b}" (Tipo: string)`);const i=Object.entries(a);console.log("DEBUG Memo: Controllo queste entries:",JSON.stringify(i)),i.forEach(([x,z])=>{const R=(typeof z==="string"?z.trim():z)===b;console.log(`-- DEBUG Memo Entry: Chiave="<span class="math-inline">{key}", Valore="</span>{value}" (Tipo: <span class="math-inline">{valueType}). Confronto diretto ('</span>{amountFieldId}'): <span class="math-inline">{directMatch}. Confronto con trim ('</span>{amountFieldId}'): ${R}`)});const o=e.amount;if(!o)return console.log("DEBUG Memo: Amount header non mappato, impossibile calcolare esempi completi."),[];if(console.log("DEBUG: Header mappato per 'amount' (Risultato finale find):",o),!o)return console.log("DEBUG Memo: Amount header NON trovato, ritorno array vuoto."),[];console.log(`DEBUG Memo: Amount header trovato: "${o}". Calcolo esempi...`);const H=l.map((x,z)=>{const k=e.walletId?x[e.walletId]??"N/D":"Non Mappato",ee=e.cause?x[e.cause]??"N/D":"Non Mappato",R=e.date?x[e.date]??"N/D":"Non Mappato",re=x[o],P=parseFloat(re);let V="Non determinato";const y=h();if(y.mode==="auto")V=P<0===y.negativeIsExpense?"Expense":"Income";else if(y.mode==="column"&&y.columnName&&y.positiveValue&&y.negativeValue){const q=x[y.columnName];q===y.positiveValue?V="Income":q===y.negativeValue&&(V="Expense")}return{walletId:k,cause:ee,amount:isNaN(P)?"N/A":P,date:R,interpretation:V}});return console.log(`DEBUG: Esempi dettagliati calcolati: ${H.length}`),H}),Oe=async()=>{console.log("Processing data before sending..."),Z(null);const a=F.data?.rows,e=G(),l=h();if(!a||a.length===0){Z("Nessun dato da processare.");return}const b=pt(a,e,l);console.log("Dati processati pronti per l'invio:",b);const i=b.filter(o=>o.amount!==null&&o.type!==null);if(i.length===0){Z("Nessuna transazione valida trovata dopo il processamento. Controlla la mappatura e i dati.");return}try{await dt.api.post("API/Wallets/Wallet/addTransactionByFile/addTransactions",{transactions:i,walletId:F.walletId}),console.log(`Inviate ${i.length} transazioni processate al server.`),Ne("complete")}catch(o){console.error("Errore durante l'invio dei dati processati:",o),Z(o.response?.data?.message||o.message||"Errore durante l'invio dei dati al server")}};return(()=>{var a=c(xt),e=a.firstChild,l=e.nextSibling,b=l.nextSibling,[i,o]=u(b.nextSibling),H=i.nextSibling,x=H.firstChild,z=x.firstChild,k=z.nextSibling,ee=k.nextSibling,R=x.nextSibling,re=R.firstChild,P=re.nextSibling,V=P.nextSibling,y=V.firstChild,[q,Ue]=u(y.nextSibling),W=q.nextSibling,Ge=W.firstChild,Ae=Ge.firstChild,He=Ae.nextSibling,xe=H.nextSibling,Re=xe.firstChild,se=Re.nextSibling,_e=se.firstChild,Pe=_e.firstChild,qe=Pe.nextSibling,fe=qe.firstChild,he=fe.firstChild,We=fe.nextSibling,ye=We.firstChild,Je=_e.nextSibling,[Se,Qe]=u(Je.nextSibling),Ke=Se.nextSibling,[Xe,Ye]=u(Ke.nextSibling),oe=xe.nextSibling,te=oe.firstChild,Ze=te.firstChild,[Ce,et]=u(Ze.nextSibling);Ce.nextSibling;var tt=te.nextSibling,[nt,at]=u(tt.nextSibling),Ee=oe.nextSibling,we=Ee.firstChild,lt=we.nextSibling,[it,rt]=u(lt.nextSibling);return n(a,p(w,{get when(){return ce()},get children(){var t=c(gt);return n(t,ce),t}}),i,o),n(ee,p(U,{get each(){return F.data?.headers},children:t=>{const d=X(()=>Object.keys(G()).includes(t));return(()=>{var r=c(ft),s=r.firstChild,m=s.firstChild,v=m.nextSibling,[_,S]=u(v.nextSibling);return K(r,"dragstart",Fe(t)),n(m,t),n(s,p(w,{get when(){return d()},get children(){var $=c(_t);return $.$$click=()=>be(t),ne(),$}}),_,S),C($=>{var E=`p-3 rounded-md cursor-grab ${d()?"bg-gray-300 text-gray-600":"bg-blue-100 hover:bg-blue-200 text-blue-800"}`,D=!d();return E!==$.e&&ae(r,$.e=E),D!==$.t&&ot(r,"draggable",$.t=D),$},{e:void 0,t:void 0}),r})()}})),n(V,p(U,{each:pe,children:t=>{const d=X(()=>$e(t.id)),r=Ve.includes(t.id);return(()=>{var s=c(yt),m=s.firstChild,v=m.firstChild,_=v.firstChild,S=_.nextSibling,[$,E]=u(S.nextSibling),D=v.nextSibling,[L,j]=u(D.nextSibling);return K(s,"drop",ue(t.id)),s.addEventListener("dragleave",me),K(s,"dragover",ge(t.id)),n(_,()=>t.label),n(v,r&&c(St),$,E),n(m,p(w,{get when(){return d()},get children(){var B=c(ht),I=B.firstChild,f=I.nextSibling;return n(I,d),f.$$click=()=>je(t.id),ne(),B}}),L,j),C(()=>ae(s,`p-3 rounded-md border-2 ${de()===t.id?"border-blue-500 bg-blue-50":d()?"border-green-500 bg-green-50":r?"border-yellow-300 bg-yellow-50":"border-gray-300 bg-white"}`)),s})()}}),q,Ue),K(W,"drop",ue("non_utilizzare")),W.addEventListener("dragleave",me),K(W,"dragover",ge("non_utilizzare")),n(He,p(U,{get each(){return Object.entries(G())},children:([t,d])=>p(w,{when:d==="non_utilizzare",get children(){var r=c(Ct),s=r.firstChild,[m,v]=u(s.nextSibling),_=m.nextSibling;return n(r,t,m,v),_.$$click=()=>be(t),ne(),r}})})),he.addEventListener("change",()=>N({mode:"auto"})),ye.addEventListener("change",()=>N({mode:"column"})),n(se,p(w,{get when(){return h().mode==="auto"},get children(){var t=c(mt),d=t.firstChild,r=d.nextSibling,s=r.firstChild,m=s.firstChild,v=r.nextSibling,_=v.firstChild,S=_.firstChild;return m.addEventListener("change",()=>N({negativeIsExpense:!0})),S.addEventListener("change",()=>N({negativeIsExpense:!1})),C(()=>M(m,"checked",h().negativeIsExpense===!0)),C(()=>M(S,"checked",h().negativeIsExpense===!1)),t}}),Se,Qe),n(se,p(w,{get when(){return h().mode==="column"},get children(){var t=c(ut),d=t.firstChild,r=d.firstChild,s=r.nextSibling,m=s.firstChild,v=m.nextSibling,[_,S]=u(v.nextSibling),$=d.nextSibling,E=$.firstChild,D=E.firstChild,L=D.nextSibling,j=E.nextSibling,B=j.firstChild,I=B.nextSibling;return s.addEventListener("change",f=>N({columnName:f.currentTarget.value})),n(s,p(U,{get each(){return F.data?.headers},children:f=>(()=>{var J=c(Et);return M(J,"value",f),n(J,f),J})()}),_,S),L.addEventListener("change",f=>N({positiveValue:f.currentTarget.value})),I.addEventListener("change",f=>N({negativeValue:f.currentTarget.value})),C(()=>M(s,"value",h().columnName||"")),C(()=>M(L,"value",h().positiveValue||"")),C(()=>M(I,"value",h().negativeValue||"")),t}}),Xe,Ye),te.$$click=()=>Le(!A()),n(te,()=>A()?"▼ ":"► ",Ce,et),n(oe,p(w,{get when(){return A()},get children(){var t=c(vt),d=t.firstChild,[r,s]=u(d.nextSibling),m=r.nextSibling,[v,_]=u(m.nextSibling);return n(t,p(w,{get when(){return X(()=>!!A())()&&ve().length>0},get children(){var S=c(bt),$=S.firstChild,E=$.nextSibling,D=E.firstChild,L=D.nextSibling,j=L.firstChild,B=j.firstChild,[I,f]=u(B.nextSibling);I.nextSibling;var J=L.nextSibling;return n(j,p(U,{each:pe,children:T=>(()=>{var Q=c(wt);return n(Q,()=>T.label),Q})()}),I,f),n(J,p(U,{get each(){return ve()},children:T=>(()=>{var Q=c(Dt),De=Q.firstChild,Ie=De.nextSibling,Te=Ie.nextSibling,Me=Te.nextSibling;return n(De,()=>T.amount),n(Ie,()=>T.cause),n(Te,()=>T.date),n(Me,()=>T.interpretation),C(()=>ae(Me,`p-2 font-medium ${T.interpretation==="Income"?"text-green-600":T.interpretation==="Expense"?"text-red-600":"text-gray-600"}`)),Q})()})),S}}),r,s),n(t,p(w,{get when(){return X(()=>!!A())()&&!$e("amount")},get children(){return c($t)}}),v,_),t}}),nt,at),we.$$click=()=>Ne("preview"),n(Ee,p(ct,{onClick:Oe,text:"Conferma mappatura"}),it,rt),C(()=>ae(W,`p-3 rounded-md border-2 ${de()==="non_utilizzare"?"border-red-500 bg-red-50":"border-gray-300 bg-white"}`)),C(()=>M(he,"checked",h().mode==="auto")),C(()=>M(ye,"checked",h().mode==="column")),ne(),a})()}st(["click"]);export{Ot as default};
