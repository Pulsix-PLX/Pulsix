import t from"vite-plugin-node-polyfills/shims/process";import{u as n,h as c}from"./assets/fetchEvent-9EzSf9d7.js";import{d as a}from"./assets/db.server-CDeyn5Z_.js";import{g as l}from"./assets/auth.server-ChqlnWrh.js";import{j as u}from"./assets/response-CbUr9JDj.js";import"h3";import"vite-plugin-node-polyfills/shims/global";import"node:async_hooks";import"pg";import"./assets/server-fns-runtime-C3tiYEg6.js";import"solid-js/web";import"solid-js/web/storage";async function I(s){console.log("Logout");const r=await l();console.log(r);try{await(await n(s.nativeEvent,{password:t.env.SESSION_SECRET,name:t.env.JWT_ISSUER,cookie:{maxAge:86400,secure:!0,httpOnly:!0,sameSite:"lax"}})).clear(),console.log("Logout: Sessione server-side pulita.")}catch(e){console.error("Logout: Errore aggiornamento sessione server-side:",e)}const i={httpOnly:!0,secure:!0,sameSite:"strict",path:"/"};try{c(s.nativeEvent,"refresh_token",i),console.log("Refresh token cookie deletion instruction sent.")}catch(e){console.error("Error clearing refresh token cookie during logout:",e)}const o=r;if(o)try{await a.query("DELETE FROM auth.active_sessions WHERE user_id = $1",[o]),console.log(`Cleared active_sessions for user: ${o}`)}catch(e){console.error("Error clearing active session during logout:",e)}else console.log("No userId found in nativeEvent context, skipping active_sessions clear.");return u({success:!0})}export{I as POST};
