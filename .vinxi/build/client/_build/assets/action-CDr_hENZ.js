import{N as R,O as D,o as P,s as F,l as C,h as T}from"./web-DcXN-p99.js";import{u as _,g as j,j as B,l as I,m as M}from"./routing-BUmn5GEU.js";const $="Location",k=5e3,K=18e4;let w=new Map;setInterval(()=>{const t=Date.now();for(let[e,n]of w.entries())!n[4].count&&t-n[0]>K&&w.delete(e)},3e5);function m(){return w}function U(t,e=!0){return R(()=>{const n=Date.now();L(t,o=>{e&&(o[0]=0),o[4][1](n)})})}function L(t,e){t&&!Array.isArray(t)&&(t=[t]);for(let n of w.keys())(t===void 0||X(n,t))&&e(w.get(n))}function y(t,e){t.GET&&(t=t.GET);const n=(...o)=>{const a=m(),s=j(),l=B(),O=T()?_():void 0,d=Date.now(),g=e+A(o);let r=a.get(g),p;if(D()&&(p=!0,P(()=>r[4].count--)),r&&r[0]&&(s==="native"||r[4].count||Date.now()-r[0]<k)){p&&(r[4].count++,r[4][0]()),r[3]==="preload"&&s!=="preload"&&(r[0]=d);let i=r[1];return s!=="preload"&&(i="then"in r[1]?r[1].then(f(!1),f(!0)):f(!1)(r[1]),s==="navigate"&&R(()=>r[4][1](r[0]))),l&&"then"in i&&i.catch(()=>{}),i}let c;return F.has&&F.has(g)?(c=F.load(g),delete globalThis._$HY.r[g]):c=t(...o),r?(r[0]=d,r[1]=c,r[3]=s,s==="navigate"&&R(()=>r[4][1](r[0]))):(a.set(g,r=[d,c,,s,C(d)]),r[4].count=0),p&&(r[4].count++,r[4][0]()),s!=="preload"&&(c="then"in c?c.then(f(!1),f(!0)):f(!1)(c)),l&&"then"in c&&c.catch(()=>{}),c;function f(i){return async u=>{if(u instanceof Response){const b=u.headers.get($);if(b!==null){O&&b.startsWith("/")?R(()=>{O(b,{replace:!0})}):window.location.href=b;return}u.customBody&&(u=await u.customBody())}if(i)throw u;return r[2]=u,u}}};return n.keyFor=(...o)=>e+A(o),n.key=e,n}y.get=t=>m().get(t)[2];y.set=(t,e)=>{const n=m(),o=Date.now();let a=n.get(t);a?(a[0]=o,a[1]=Promise.resolve(e),a[2]=e,a[3]="preload"):(n.set(t,a=[o,Promise.resolve(e),e,"preload",C(o)]),a[4].count=0)};y.delete=t=>m().delete(t);y.clear=()=>m().clear();function X(t,e){for(let n of e)if(n&&t.startsWith(n))return!0;return!1}function A(t){return JSON.stringify(t,(e,n)=>H(n)?Object.keys(n).sort().reduce((o,a)=>(o[a]=n[a],o),{}):n)}function H(t){let e;return t!=null&&typeof t=="object"&&(!(e=Object.getPrototypeOf(t))||e===Object.prototype)}const E=new Map;function q(t){const e=I();return(...n)=>t.apply({r:e},n)}function v(t,e={}){function n(...s){const l=this.r,h=this.f,O=(l.singleFlight&&t.withOptions?t.withOptions({headers:{"X-Single-Flight":"true"}}):t)(...s),[d,g]=C();let r;function p(c){return async f=>{const i=await W(f,c,l.navigatorFactory());let u=null;if(o.onComplete?.({...r,result:i?.data,error:i?.error,pending:!1,retry(){return u=r.retry()}}),u)return u;if(!i)return r.clear();if(g(i),i.error&&!h)throw i.error;return i.data}}return l.submissions[1](c=>[...c,r={input:s,url:a,get result(){return d()?.data},get error(){return d()?.error},get pending(){return!d()},clear(){l.submissions[1](f=>f.filter(i=>i!==r))},retry(){return g(void 0),t(...s).then(p(),p(!0))}}]),O.then(p(),p(!0))}const o=typeof e=="string"?{name:e}:e,a=t.url||o.name&&`https://action/${o.name}`||`https://action/${N(t.toString())}`;return n.base=a,S(n,a)}function S(t,e){return t.toString=()=>{if(!e)throw new Error("Client Actions need explicit names if server rendered");return e},t.with=function(...n){const o=function(...s){return t.call(this,...n,...s)};o.base=t.base;const a=new URL(e,M);return a.searchParams.set("args",A(n)),S(o,(a.origin==="https://action"?a.origin:"")+a.pathname+a.search)},t.url=e,E.set(e,t),T()&&P(()=>E.delete(e)),t}const N=t=>t.split("").reduce((e,n)=>(e<<5)-e+n.charCodeAt(0)|0,0);async function W(t,e,n){let o,a,s,l;if(t instanceof Response){if(t.headers.has("X-Revalidate")&&(s=t.headers.get("X-Revalidate").split(",")),t.customBody&&(o=a=await t.customBody(),t.headers.has("X-Single-Flight")&&(o=o._$value,delete a._$value,l=Object.keys(a))),t.headers.has("Location")){const h=t.headers.get("Location")||"/";h.startsWith("http")?window.location.href=h:n(h)}}else{if(e)return{error:t};o=t}return L(s,h=>h[0]=0),l&&l.forEach(h=>y.set(h,a[h])),await U(s,!1),o!=null?{data:o}:void 0}export{E as a,v as b,q as u};
